!function(e){"use strict";function t(e){this.html=this.toHTML(),e&&this.html.classList.add.apply(this.html.classList,e.split(" ")),this.init.apply(this,Array.prototype.slice.call(arguments,1))}function i(e){this.data=w.get(e);var t=Array.prototype.slice.call(arguments,1);t.unshift(null),i.prototype.super.apply(this,t)}function n(e,t,i){this.locked=!0,this.clickable=null,this.options=null,this.optionsWrapper=null,this.owner=t,this.parentAction=i||null,this.repeated=0,this.chosenOptionId=null,this.energyDrain=null,this.super(e)}function s(e){this.super(e)}function o(e,t){var i=b.getNow();console.log("Loaded in "+i+"ms"),console.log("Starting v0.4.3"),this.assets=t,this.resources=new Map,this.buildings=new Map,this.incidents=new Map,this.people=[],this.initialActions=[],this.knownLocations=[],this.buildingsInProgress=[],this.flags={ready:!1,paused:!1,win:!1,gameOver:!1,settled:0,popup:!1},this.lastTick=i,o.holder=e,this.super(null,e),console.log("Started in "+(b.getNow()-i)+"ms")}function r(e){this.timer=null,this.nameNode=null,this.progressBar=null,this.tooltip=null,this.super(e)}function a(e){e=e||1;return c.randomName(e).then(function(e){var t=[];return e.results.forEach(function(e){var i=new c(b.capitalize(e.name.first+""),e.gender);t.push(i)}),t})}function c(e,t){this.name=e,this.gender=t||"other",this.actions=new Map,this.busy=!1,this.energyDrain=.7,this.energy=100,this.life=100,this.stats={idle:0,age:0},this.perk=null,this.super()}function l(e,t){if(l.usedId.includes(e))throw new RangeError("This perk is already used ["+e+"]");l.usedId.push(e),this.owner=t,this.super(e)}function u(e,t){this.count=0,this.warnLack=!1,this.super(e,t)}function h(e,t){this.value=null,this.threshold=t||0,this.super(e)}function d(e,t,i){this.text=t,this.timeout=null,this.super(e),this.setAction(i)}function m(e,t){this.data=e,this.super(t),this.show()}function p(e,t){this.container=e,this.nodes={},this.resourcesMapper={},this.super(null,t)}var f={prepareCanvas:function(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,{cnv:i,ctx:i.getContext("2d")}}};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};var g={floor:function(e){return e<<0},round:function(e){return g.floor(e+.5)},ceil:function(e){return g.floor(e+1)},abs:Math.abs,diff:function(e,t){return g.abs(e-t)},constrain:function(e,t,i){return e<t?t:e>i?i:e},random:function(){var e=Math.random;return function(t,i){return void 0===i?(i=void 0===t?1:+t||1,t=0):(t=+t||0,i=+i||1),e()*(i-t)+t}}()};Number.prototype.equals=function(e){return b.isNumber(e)&&g.diff(this,e)<=Number.EPSILON},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.random=function(){return this[g.floor(g.random(0,this.length))]},Array.prototype.out=function(e){var t=this.indexOf(e);return t>=0&&this.splice(t,1),this.length},Array.prototype.insert=function(e){return this.push.apply(this,e)},Map.prototype.push=function(e,t){return b.isUndefined(t)&&(e=(t=e).id||t.data&&t.data.id||new String),this.set(e,t),e},Map.prototype.getValues=function(){for(var e=this.values(),t=[],i=e.next();!i.done;)t.push(i.value),i=e.next();return t},Map.prototype.getKeys=function(){for(var e=this.keys(),t=[],i=e.next();!i.done;)t.push(i.value),i=e.next();return t},Object.prototype.browse=function(e,t){Object.keys(this).forEach(function(i){e.call(t,this[i],i,this)},this)},Object.prototype.values=function(){return Object.values(this)},Object.prototype.flatten=function(){var e=[];return this.deepBrowse(function(t){e.push(t)}),e},Object.prototype.deepBrowse=function(e,t){["Object","Array"].includes(this.constructor.name)?this.browse(function(i){i.deepBrowse(e,t)}):e.call(t,this)},Object.prototype.swap=function(){var e={};return this.browse(function(t,i){e[t]=i}),e},Object.prototype.clone=function(){var e;if([Boolean,Number,String].includes(this.constructor))e=this;else if(this instanceof Array)e=this.slice();else{if(!(this instanceof Object))throw new TypeError("Improbable source type");e=Object.assign({},this)}return e},HTMLElement.prototype.show=function(){this.removeAttribute("aria-hidden")},HTMLElement.prototype.hide=function(){this.setAttribute("aria-hidden","true")},HTMLElement.prototype.show=function(){this.removeAttribute("aria-hidden")},HTMLElement.prototype.hide=function(){this.setAttribute("aria-hidden","true")},Function.prototype.extends=function(e,t,i){if(e&&(this.prototype=Object.create(e.prototype),this.prototype.super=e,this.prototype.constructor=this,this.prototype.modelName=t),i){var n=this;i.browse(function(e,t){n.prototype[t]&&(n.prototype["_"+t]=n.prototype[t]),n.prototype[t]=e})}};var b={noop:new Function,wrap:function(e,t){var i=document.createElement("div");return e&&(i.className=e),t&&(i.innerHTML=t),i},formatJoin:function(e,t){return e.length>1?e.slice(0,e.length-1).join(", ")+" "+(t||"and")+" "+e.last():e.length?""+e[0]:""},formatArray:function(e){return b.formatJoin(e.map(function(e){return new u(e[1],e[0])}))},formatTime:function(e){if(!e)return"0 hour";var t=["year","month","day","hour","minute"],i=[],n=w.time;return t.forEach(function(t){if(e>n[t]){var s=g.floor(e/n[t]);e%=n[t],i.push(s+" "+b.pluralize(t,s))}}),b.formatJoin(i)},pluralize:function(e,t){return e+(t>1&&"s"!==e[e.length-1]?"s":"")},capitalize:function(e){return e?(e=e.replace(/([.!?]) ([a-z])/g,function(e,t,i){return t+" "+i.toUpperCase()}))[0].toUpperCase()+e.slice(1):""},randomize:function(e,t){if(!e.values().length)throw new TypeError("Can't pick from empty list");var i={},n=[],s=0;e.deepBrowse(function(e){var t=w.get(e);t.dropRate&&(s+=t.dropRate,n.push(s),i[s]=e)});var o=g.floor(g.random(s));n.sort(function(e,t){return e-t});for(var r=0,a=n.length;r<a;++r)if(n[r]>o){o=n[r];break}return t?(b.isArray(t)||(t=b.isString(t)?t.split("-"):[+t]),[g.round(g.random.apply(null,t)),i[o]]):i[o]},randomizeMultiple:function(e,t){if(!t)throw new TypeError("Need an amount");var i=[];b.isArray(t)||(t=b.isString(t)?t.split("-"):[+t]);for(var n=g.round(g.random.apply(null,t)),s=0;s++<n;)i.push([1,b.randomize(e)]);return b.compactResources(i)},log:function(){},randomStr:function(e){return e=e||6,new Array(e).fill("-").join("").replace(/-/g,function(){return g.floor(g.random(36)).toString(36)})},pickUniqueID:function(){var e=[];return function(){var t=b.randomStr();return e.includes(t)?b.pickUniqueID():(e.push(t),t)}}(),isFunction:function(e){return e instanceof Function},isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isUndefined:function(e){return void 0===e},sanitize:function(e){return e.replace(/^\W+|\W+$/g,"").replace(/\W+/g,"_").toLowerCase()},camelize:function(e){return e.replace(/^\W+/,"").toLowerCase().replace(/\W+(\w?)/g,function(e,t){return t&&t[0].toUpperCase()+t.slice(1)})},an:function(e){return e.length?("aeiou".split("").includes(e[0])?"an":"a")+" "+e:""},compactResources:function(e){return e.reduce(function(e,t){var i=e.find(function(e){return e[1]===t[1]});return i?i[0]+=t[0]:t[0]>0&&e.push(t),e},[])},getNow:function(){return g.floor(performance.now())},loadAsync:function(e,t){var i={},n=0,s=e.length;return Promise.all(e.map(function(e){var o,r=fetch(e).then(function(t){if(t.ok)return t;throw new URIError("["+t.status+"] "+e+" "+t.statusText)});switch(e.substr(e.lastIndexOf(".")+1)){case"png":case"jpg":case"gif":o=r.then(function(e){var t=new Image;return e.blob().then(function(e){return t.src=URL.createObjectURL(e),t})});break;case"json":o=r.then(function(e){return e.json()});break;default:o=Promise.resolve()}return o.then(function(o){i[b.sanitize(e)]=o,t(++n/s*100,e)})})).then(function(){return i})}};t.extends(Object,"View",{init:b.noop,toHTML:function(){return b.wrap(this.modelName)},show:function(){this.html.show()},hide:function(){this.html.hide()}}),i.extends(t,"Model",{toJSON:function(){return{id:this.data.id}}});var v=function(){var e={};return function(e,t){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=+new Date;var i=document.createElement("script"),n=document.getElementsByTagName("script")[0];i.async=1,i.src="https://www.google-analytics.com/analytics.js",n.parentNode.insertBefore(i,n)}(e,"ga"),e.ga("create","UA-99773946-1","auto"),e.ga("send","pageview"),function(t,i,n){e.ga("send","event","Game",t,i,n)}}();e.starter=function(e){console.groupCollapsed("Loading");var t=b.getNow();b.loadAsync(["dist/img/icons.png","dist/img/assets.png","dist/json/assets.json","dist/json/buildingsData.json"],function(e,i){console.log(i+" : "+e.toFixed(1)+"% - "+(b.getNow()-t))}).then(function(e){console.groupEnd(),new o(document.body,{images:e[b.sanitize("dist/img/assets.png")],data:{assets:e[b.sanitize("dist/json/assets.json")],positions:e[b.sanitize("dist/json/buildingsData.json")]}})}).catch(function(e){console.warn("Fail to load game : "+e.message,e.stack)})};var w=function(){function e(e){var t=btoa(e.id);return e.id=t,s[t]=e,t}var t={minute:1/60,hour:1,day:24,week:168,month:720,year:8760},i=["north","south","east","west","north-east","north-west","south-east","south-west"],n={resources:{gatherables:{common:{},uncommon:{},rare:{}},craftables:{basic:{},complex:{},advanced:{}},special:{}},buildings:{small:{},medium:{},big:{},special:{}},actions:{},locations:{near:{},far:{},epic:{}},incidents:{easy:{},medium:{},hard:{}},perks:{}},s={};n.option="opt",n.resources.room=e({id:"rom",name:"room",desc:"A place for someone in the camp.",icon:"person",order:0}),n.resources.gatherables.common.water=e({id:"wtr",name:"water",desc:"Water is definitely important to survive in this harsh environment.",icon:"water-bottle",dropRate:100,order:10}),n.resources.gatherables.common.food=e({id:"fod",name:"food",desc:"Everyone need food to keep his strength.",icon:"foodcan",dropRate:90,order:20}),n.resources.gatherables.common.rock=e({id:"rck",name:"rock",desc:'"There\'s rocks everywhere ! Why would you bring this back ?"',icon:"rock",dropRate:100,order:30}),n.resources.gatherables.common.scrap=e({id:"scp",name:"scrap metal",desc:"An old rusty piece of metal.",icon:"metal-scraps",dropRate:75,order:40}),n.people=e({id:"plp",name:"people",desc:"The workforce and the bane of you camp.",needs:[[1.2/t.day,n.resources.gatherables.common.water,"thirsty"],[1/t.day,n.resources.gatherables.common.food,"starving"]],dropRate:.05}),n.resources.gatherables.uncommon.bolts=e({id:"blt",name:"nuts and bolts",desc:"Little metal nuts and bolts to fasten anything in place.",icon:"nuts-and-bolts",dropRate:70,order:50}),n.resources.gatherables.uncommon.sand=e({id:"snd",name:"sand",desc:"Just pure fine sand.",icon:"sand-pile",dropRate:40,order:55}),n.resources.gatherables.uncommon.oil=e({id:"oil",name:"fuel",desc:"About a liter of gas-oil.",icon:"jerrycan",dropRate:10,order:60}),n.resources.gatherables.rare.medication=e({id:"mct",name:"medication",desc:"An unlabeled medication, hope it's still good.",icon:"medications",dropRate:7,order:70}),n.resources.gatherables.rare.electronic=e({id:"elc",name:"electronics",desc:"Some basic micro-electronics components.",icon:"electronic-parts",dropRate:10,order:75}),n.resources.special.ruins=e({id:"run",name:"location",desc:"Directions to a point of interest we found earlier.",icon:"map",order:80,dropRate:.6}),n.resources.special.quartz=e({id:"qtz",name:"quartz cristal",desc:"A rough uncut gem of quartz. Quite valuable.",icon:"gem",dropRate:10,order:77}),n.resources.craftables.basic.component=e({id:"cmp",name:"component",desc:"Some mechanical parts for others craftables.",icon:"pipes-large",consume:[[2,n.resources.gatherables.common.scrap],[2,n.resources.gatherables.uncommon.bolts]],dropRate:120,order:110}),n.buildings.special.wreckage=e({id:"wrk",name:"wreckage",desc:"Remainings of space-ships.",asset:"wreckage",order:0}),n.actions.launch=e({id:"lnc",name:"launch",desc:"Finally set off this module to get out of that damn wasteland.",time:12,energy:30,isOut:1,unique:!0,consume:[[10,n.resources.gatherables.uncommon.oil]],effect:function(){E.notify(E.MSG_TYPES.WIN,this.getSettledTime())},log:function(){return"After "+this.getSurvivalDuration()+", you finally leave this damn crash-site.<br/>You have to leave everyone behind. You make a promise to yourself to come back as soon as you can."},order:15}),n.actions.exchange=e({id:"exc",name:"exchange",desc:"Caravan passing by carry lots of useful stuff, let's see what's possible to trade.",time:7,energy:20,consume:[[2,n.resources.craftables.complex.jewelry]],giveSpan:[2,3],giveList:[n.resources.craftables.basic,n.resources.craftables.complex],log:"@people.name manage to trade a couple of jewelries for @give.",order:10}),n.actions.nurse=e({id:"nrs",name:"nurse",desc:"Look after the health of the most needed one.",time:2,energy:1,consume:[[2,n.resources.gatherables.rare.medication]],effect:function(e,t,i){var n=null;this.people.forEach(function(e){(!n||e.life<n.life)&&(n=e)}),n.updateLife(99),i.cured=n},log:"Thanks to @people.name, @cured.name feel better.",order:7}),n.actions.heal=e({id:"hel",name:"heal",desc:'"I really hope those pills are still good."',time:2,energy:1,consume:[[2,n.resources.gatherables.rare.medication]],effect:function(e,t,i){var s=99,o=this.buildings.has(n.buildings.small.pharmacy),r=e.owner.hasPerk(n.perks.healer);!o&&!r&&g.random()<.4&&(s=-10,i.wasBad=!0),e.owner.updateLife(s)},log:function(e){return e.wasBad?"After feeling not so well, @people.name realise taking these pillstook a hit on his health.":"This time, it actually improve @people.name's health."},order:6}),n.actions.sleep=e({id:"slp",name:"sleep",desc:"Get some rest to restore energy.",time:7,energy:0,effect:function(e){e.owner.updateEnergy(99)},unlock:[n.actions.heal],log:"@people.name feels well rested now.",order:5}),n.actions.harvestPlot=e({id:"hrp",name:"harvest crops",desc:"It's not the biggest vegetables, but it'll fill our stomachs.",time:4,consume:[[2,n.resources.gatherables.common.water]],giveSpan:[1.5,2],giveList:[n.resources.gatherables.common.food],log:"Our crops produce @give.",order:70}),n.actions.harvestField=e({id:"hrf",name:"harvest crops",desc:"It's not the biggest vegetables, but it'll fill our stomachs.",time:6,consume:[[3,n.resources.gatherables.common.water]],giveSpan:[3,4],giveList:[n.resources.gatherables.common.food],log:"Our crops produce @give.",order:70}),n.actions.drawFromRiver=e({id:"dfr",name:"draw water",desc:"Get some water from the river.",time:8,energy:50,isOut:1,condition:function(e){return!e.owner.actions.has(n.actions.drawFromWell)},giveSpan:[2,6],giveList:[n.resources.gatherables.common.water],log:"Coming back from the river, @people.name brings @give with @people.accusative.",order:60}),n.actions.drawFromWell=e({id:"dfw",name:"draw water",desc:"Get some water from our well.",time:2,energy:15,giveSpan:[1,3],giveList:[n.resources.gatherables.common.water],log:"Using our well, @people.name get @give.",order:60}),n.actions.drawFromPump=e({id:"dfp",name:"draw water",desc:"Get some water at the pump.",time:2,giveSpan:[3,3],giveList:[n.resources.gatherables.common.water],log:"Using our pump, @people.name get @give.",order:60}),n.actions.build=e({id:"bui",name:"build",desc:"Put together some materials to come up with what looks like a building.",build:n.option,options:function(){return this.possibleBuildings()},order:50}),n.actions.craft=e({id:"crf",name:"craft",desc:"Use some resources to tinker something useful.",time:5,energy:15,options:function(){return this.unlockedCraftables()},give:[[1,n.option]],unlock:[n.actions.build],log:"@people.name succeeds to craft @give.",order:30}),n.actions.explore=e({id:"xpl",name:"explore",desc:"Remember that location we saw the other day ? Let's see what we can find there.",time:t.day,energy:100,isOut:1,consume:[[2,n.resources.gatherables.common.water],[1,n.resources.gatherables.common.food],[1,n.resources.special.ruins]],options:function(){return this.knownLocations},giveSpan:[7,10],giveList:[n.resources.special.quartz],log:"All locations should have own log",order:20});var o=s[n.resources.special.ruins].dropRate;return n.actions.scour=e({id:"scr",name:"scour",desc:"Knowledge of the area allows for better findings.",time:4,isOut:1,consume:[[1,n.resources.gatherables.common.water]],giveSpan:[1.5*o/2,(1.5*o+1)/2],giveList:[n.resources.special.ruins],log:function(e){var t;if(e.give){var s=b.randomize(n.locations);this.knownLocations.includes(s)||this.knownLocations.push(s),e.location=b.an(w.get(s).name),t="@people.name knew @people.nominative could find @location towards @direction."}else t="No special location towards @direction.";return e.direction=i.random(),t},order:10}),n.actions.roam=e({id:"ram",name:"roam",desc:"Explore the surroundings hoping to find something interesting.",time:5,isOut:1,consume:[[1,n.resources.gatherables.common.water]],condition:function(e){return!e.owner.actions.has(n.actions.scour)},unlock:[n.actions.explore],unlockAfter:[[9,n.actions.scour]],giveSpan:[o/2,(o+1)/2],giveList:[n.resources.special.ruins],log:function(e){var t;if(e.give){var s=b.randomize({near:n.locations.near,far:n.locations.far});this.knownLocations.includes(s)||this.knownLocations.push(s),e.location=b.an(w.get(s).name),t="Heading @direction, @people.name spots @location"}else t="@people.name found nothing special towards @direction.";return e.direction=i.random(),t},order:10}),n.actions.gather=e({id:"gtr",name:"gather resources",desc:"Go out to bring back resources, that's the best you can do.",time:3,isOut:1,unlock:[n.actions.roam,n.actions.craft],giveSpan:[3,6],giveList:n.resources.gatherables.flatten(),log:"@people.name comes back with @give.",order:1}),n.buildings.special.forum=e({id:"fr0",name:"forum",desc:"The center and start of our settlement.",unlockForAll:[n.actions.sleep],upgrade:n.buildings.special.wreckage,give:[[1,n.resources.room]],asset:"forum",order:1}),n.actions.settle=e({id:"stl",name:"settle here",desc:"Ok, let's settle right there !",time:2,energy:0,effect:function(){this.flags.settled=1},unlock:[n.actions.gather],build:n.buildings.special.forum,log:"@people.name installs @build inside a ship-wreck with @give to sleep in.",order:0,unique:!0}),n.actions.look=e({id:"lok",name:"look around",desc:"What am I doing here ?",time:1,energy:0,effect:function(){L.timeout(function(){E.notify(E.MSG_TYPES.LOGS.QUOTE,"We need a shelter.")},1500)},give:[[10,n.resources.gatherables.common.water],[8,n.resources.gatherables.common.food],[2,n.resources.craftables.basic.component]],unlock:[n.actions.settle],log:"After some thinking, @people.name remembers the attack. @people.nominative grabs @give laying around.",order:0,unique:!0}),n.actions.wakeUp=e({id:"wku",name:"wake up",unlock:[n.actions.look],effect:function(e){e.owner.updateEnergy(100),e.owner.updateLife(100)},log:"@people.name gets up painfully.",order:0,unique:!0}),n.resources.craftables.basic.stone=e({id:"stn",name:"smooth stone",desc:"A round and well polish stone.",icon:"stone",consume:[[3,n.resources.gatherables.common.rock]],dropRate:100,order:90}),n.resources.craftables.basic.tool=e({id:"tol",name:"tool",desc:"The base for any tinkerer.",icon:"tools",consume:[[1,n.resources.craftables.basic.component],[2,n.resources.gatherables.common.rock]],dropRate:90,order:111}),n.buildings.small.furnace=e({id:"frn",name:"furnace",desc:"Survival require to craft as much as to gather things.",time:7,consume:[[8,n.resources.gatherables.common.rock],[2,n.resources.gatherables.uncommon.oil]],asset:"furnace",order:15,log:"A simple furnace that can smelt small things like sand or little electronics."}),n.resources.craftables.basic.glass=e({id:"gls",name:"glass pane",desc:"A see-through building component.",icon:"glass-pane",ifHas:n.buildings.small.furnace,consume:[[4,n.resources.gatherables.uncommon.sand]],dropRate:60,order:100}),n.buildings.small.forum1=e({id:"fr1",name:"forum+1",desc:"Add one room.",time:2,upgrade:n.buildings.special.forum,consume:[[6,n.resources.gatherables.uncommon.bolts],[4,n.resources.gatherables.common.scrap]],give:[[1,n.resources.room]],asset:"forum1",order:10,log:"It'll be nice to have someone else helping."}),n.buildings.small.plot=e({id:"plt",name:"farm plot",desc:"A little arranged plot of soil to grow some food.",time:9,consume:[[5,n.resources.gatherables.common.food],[10,n.resources.gatherables.uncommon.sand]],unlockForAll:[n.actions.harvestPlot],asset:"plot",order:12,log:"More crops required more care but that's going to help us keeping a constant stock of food."}),n.buildings.small.pharmacy=e({id:"phr",name:"pharmacy",desc:'"Maybe we should avoid letting medications rot in plain sunlight ?!"',time:6,consume:[[5,n.resources.gatherables.rare.medication],[4,n.resources.craftables.basic.component]],asset:"pharmacy",order:16,log:"Sorting our medications should prevent further mistakes and bad reaction."}),n.buildings.small.well=e({id:"wel",name:"well",desc:"Just a large hole into the ground.",time:16,consume:[[10,n.resources.gatherables.common.rock],[4,n.resources.craftables.basic.tool]],give:[[5,n.resources.gatherables.common.water]],unlockForAll:[n.actions.drawFromWell],lock:[n.actions.drawFromRiver],asset:"well",order:13,log:"Drawing water from the ground should allow to further polish stone into bricks."}),n.buildings.medium.forum2=e({id:"fr2",name:"forum+2",desc:"Add one room.",time:5,consume:[[10,n.resources.gatherables.uncommon.sand],[2,n.resources.craftables.basic.stone],[3,n.resources.craftables.basic.glass]],upgrade:n.buildings.small.forum1,give:[[1,n.resources.room]],asset:"forum2",order:20,log:"Another room for someone to join. So far, so good."}),n.buildings.medium.plot1=e({id:"fil",name:"field",desc:"A larger crop field to produce more food.",time:10,lockForAll:[n.actions.harvestPlot],unlockForAll:[n.actions.harvestField],consume:[[20,n.resources.gatherables.common.food],[5,n.resources.craftables.basic.tool],[3,n.resources.gatherables.rare.medication]],upgrade:n.buildings.small.plot,asset:"plot+1",order:25,log:"This should be enough to provide food for our small encampment."}),n.buildings.medium.forge=e({id:"frg",name:"forge",desc:"A good upgrade to the furnace.",time:10,consume:[[10,n.resources.craftables.basic.stone],[6,n.resources.gatherables.uncommon.oil],[2,n.resources.craftables.basic.tool]],upgrade:n.buildings.small.furnace,asset:"furnace+1",order:27,log:"We can now work metal better and make more complex part."}),n.resources.craftables.complex.brick=e({id:"brk",name:"brick",desc:"Bricks will give walls for larger constructions.",icon:"brick",ifHas:n.buildings.small.well,consume:[[1,n.resources.craftables.basic.stone],[1,n.resources.craftables.basic.tool]],dropRate:80,order:112}),n.resources.craftables.complex.circuit=e({id:"cir",name:"circuit",desc:"That's a little rough, but it's actually a functioning circuit board.",icon:"electronic-circuit-board",consume:[[1,n.resources.gatherables.common.scrap],[2,n.resources.craftables.basic.component],[3,n.resources.gatherables.rare.electronic]],dropRate:60,order:114}),n.resources.craftables.complex.metalPipe=e({id:"mtp",name:"metal pipe",desc:"Pipes that you forge from junk metal.",icon:"pipes-small",ifHas:n.buildings.medium.forge,consume:[[4,n.resources.gatherables.common.scrap],[1,n.resources.craftables.basic.tool]],dropRate:80,order:115}),n.resources.craftables.advanced.jewelry=e({id:"jwl",name:"jewelry",desc:"A really beautiful ornament you could use for trading.",icon:"jewelry",ifHas:n.buildings.small.furnace,consume:[[4,n.resources.gatherables.rare.electronic],[2,n.resources.special.quartz]],dropRate:40,order:117}),n.buildings.big.workshop=e({id:"wrs",name:"workshop",desc:"Organizing your workforce make them more efficient at crafting.",time:3*t.day,energy:90,ifHas:n.buildings.medium.forge,consume:[[6,n.resources.gatherables.common.scrap],[5,n.resources.craftables.basic.glass],[10,n.resources.craftables.basic.tool],[15,n.resources.craftables.complex.brick]],asset:"workshop",order:35,log:"Good organisation allow you to prepare project and do much more complex crafting."}),n.resources.craftables.complex.furniture=e({id:"fnt",name:"furniture",desc:"A proper settlement needs better than pile of trash for table and seats.",icon:"glass-table",ifHas:n.buildings.big.workshop,consume:[[2,n.resources.craftables.basic.glass],[2,n.resources.craftables.complex.metalPipe]],dropRate:40,order:116}),n.buildings.big.forum3=e({id:"fr3",name:"forum+3",desc:"Add two rooms.",time:6,consume:[[10,n.resources.craftables.complex.brick],[2,n.resources.craftables.complex.furniture],[6,n.resources.craftables.basic.glass]],upgrade:n.buildings.medium.forum2,give:[[2,n.resources.room]],asset:"forum+3",order:30,log:"All the forum space is now used for sleeping place."}),n.resources.craftables.advanced.engine=e({id:"egn",name:"engine",desc:"Amazing what you manage to do with all those scraps !",icon:"engine",ifHas:n.buildings.big.workshop,consume:[[10,n.resources.gatherables.uncommon.oil],[5,n.resources.craftables.basic.tool],[5,n.resources.craftables.complex.metalPipe]],dropRate:30,order:120}),n.resources.craftables.advanced.computer=e({id:"cmt",name:"computer",desc:"Well, Internet is down since 2136 but it can still be useful.",icon:"computer",ifHas:n.buildings.big.workshop,consume:[[10,n.resources.craftables.basic.component],[7,n.resources.craftables.basic.tool],[3,n.resources.craftables.complex.circuit]],dropRate:20,order:130}),n.buildings.big.radio=e({id:"rdo",name:"radio-station",desc:"Broadcasting could finally bring us some help.",time:6,ifHas:n.buildings.big.workshop,consume:[[4,n.resources.craftables.complex.circuit],[1,n.resources.craftables.advanced.computer]],effect:function(){w.get(n.people).dropRate=1},asset:"radio",order:37,log:'"Message received. We thought no one survive the crash. Glad you still have the cube.Unfortunately we can\'t risk being located, bring it to sent position. Over."'}),n.buildings.big.pump=e({id:"pmp",name:"water pump",desc:"A buried contraption that collect water from the earth moisture.",time:3*t.day,energy:120,consume:[[20,n.resources.craftables.basic.stone],[5,n.resources.craftables.complex.metalPipe],[1,n.resources.craftables.advanced.engine]],upgrade:n.buildings.small.well,unlockForAll:[n.actions.drawFromPump],lockForAll:[n.actions.drawFromRiver,n.actions.drawFromWell],asset:"pump",order:36,log:"A big upgrade to your well ! Now we have a continuous flow of water coming."}),n.buildings.big.trading=e({id:"trd",name:"trading post",desc:"Since the radio station bring a handful of merchant, better take advantage of it.",time:t.day,energy:70,ifHas:n.buildings.big.radio,consume:[[2,n.resources.craftables.basic.glass],[10,n.resources.craftables.complex.brick],[2,n.resources.craftables.complex.furniture]],unlockForAll:[n.actions.exchange],asset:"trading",order:38,log:"Arranging some space allow us to trade with merchant caravan passing by."}),n.buildings.big.module=e({id:"mdl",name:"module",desc:"With that, we can finally deliver the cube to security.",time:t.week,energy:100,ifHas:n.buildings.big.radio,consume:[[15,n.resources.gatherables.uncommon.oil],[3,n.resources.craftables.complex.furniture],[1,n.resources.craftables.advanced.computer],[2,n.resources.craftables.advanced.engine]],unlockForAll:[n.actions.launch],asset:"module",order:40,log:"What a journey, but there we are. We build so many things and explore lots of places.<br/>Now it's time to end it all !"}),n.locations.near.mountain=e({id:"mnt",name:"mountain",desc:"A nearby mountain that may contains some basic building resources",giveList:[n.resources.gatherables.common.rock,n.resources.gatherables.common.scrap,n.resources.craftables.basic.component],log:"That was hard to climb those mountains, but at least @people.name find @give.",dropRate:90}),n.locations.near.desert=e({id:"dst",name:"desert",desc:"Not much to find in a desert, but that's for sure the best place to get sand.",giveList:[n.resources.gatherables.common.scrap,n.resources.gatherables.uncommon.oil,n.resources.gatherables.uncommon.sand],log:"Dunes everywhere give a felling of hopelessness. Anyway, here's @give for the stock.",dropRate:100}),n.locations.near.supermarket=e({id:"hng",name:"hangar",desc:"A huge hangar. It was certainly raided before by others, but you may grab something.",giveList:[n.resources.gatherables.common.food,n.resources.gatherables.rare.medication,n.resources.craftables.basic.glass],log:"Quite easy to loot, but full of dangers too. Hopefully, @people.name return safely and got @give.",dropRate:80}),n.locations.far.river=e({id:"rvr",name:"river",desc:"Quite rare to find water around here. This is a valuable location to find.",unlockForAll:[n.actions.drawFromRiver],giveList:[n.resources.gatherables.common.water,n.resources.gatherables.uncommon.bolts,n.resources.craftables.basic.stone],log:"It's nice by the river, @people.name found @give.",dropRate:30}),n.locations.far.ruin=e({id:"orn",name:"old ruin",desc:"This is a huge underground network of rooms linked by narrow hallways. This should have provided shelter a long time ago.",giveList:[n.resources.gatherables.rare.electronic,n.resources.craftables.basic.component,n.resources.craftables.basic.tool],log:"Amazing no-one get lost in those caves to get @give.",dropRate:50}),n.locations.epic.building=e({id:"bld",name:"buried building",desc:"By digging up this building, you uncover stuff preserved from looting and environment.",giveList:[n.resources.gatherables.rare.medication,n.resources.craftables.basic.glass,n.resources.craftables.complex.circuit],log:"No-one could guess what that building was, but it sure was interesting. @people.name find @give.",dropRate:10}),n.locations.epic.spaceship=e({id:"swr",name:"spaceship wreck",desc:"This wreckage seems to be in a fairly good shape and allow you to find useful part inside.",giveList:[n.resources.gatherables.rare.electronic,n.resources.craftables.basic.tool,n.resources.craftables.complex.furniture],log:"What a chance to find a wreckage with not melted stuff inside. It was possible to get @give.",dropRate:5}),n.incidents.easy.sandstorm=e({id:"ssm",name:"sandstorm",desc:"The wind is blowing hard, impossible to go out for now.",time:16,timeDelta:4,dropRate:100,log:"A sandstorm has started and prevent anyone from leaving the camp."}),n.incidents.medium.acidRain=e({id:"acr",name:"acid rain",desc:"A big dark cloud is coming from the north, which means that it's going to rain acid droplet like stingers from the sky",time:t.day,timeDelta:t.day/2,dropRate:50,lifeLose:3,log:""}),n.incidents.hard.drought=e({id:"drg",name:"drought",desc:"The climate is so hot, we consume more water.",time:3*t.day,timeDelta:10,dropRate:10,multiplier:3,log:"A harsh drought has fall, water will be more important than ever."}),n.perks.first=e({id:"fso",name:"first-one",desc:"The very first one to install the settlement.",actions:[n.actions.settle],iteration:0}),n.perks.rookie=e({id:"rki",name:"rookie",desc:"All group has a rookie, all @people.nominative want is to prove @people.nominative's efficient.",condition:function(){return this.people.length>2},effect:function(e){e.timeBonus=.9}}),n.perks.explorer=e({id:"xpr",name:"gadabout",desc:"The veteran of the camp and leader of the exploration. @people.nominative knows the best spot of resources.",actions:[n.actions.roam,n.actions.scour,n.actions.explore],iteration:30,effect:function(e){if(e.id===n.actions.explore){e.giveSpan=e.giveSpan.map(function(e){return e+2})}}}),n.perks.tinkerer=e({id:"tnr",name:"tinkerer",desc:"Everyone is amazed by how quickly @people.nominative can put together any contraption.",actions:[n.actions.craft,n.actions.build],iteration:30,effect:function(e){e.timeBonus=.5}}),n.perks.healer=e({id:"hlr",name:"doctor",desc:"Knowing enough about medicine make @people.accusative confident to heal others.",actions:[n.actions.heal],ifHas:n.buildings.small.pharmacy,iteration:5,unlock:[n.actions.nurse]}),n.perks.harvester=e({id:"hvt",name:"harvester",desc:"A real eagle eye that can spot goods twice as fast as anyone.",actions:[n.actions.gather,n.actions.harvestField,n.actions.harvestPlot,n.actions.drawFromRiver,n.actions.drawFromWell],iteration:40,effect:function(e){e.giveSpan=e.giveSpan.map(function(e){return 1.5*e})}}),n.perks.lounger=e({id:"lng",name:"lounger",desc:"Doing nothing all day's not gonna make things done.",actions:[n.actions.sleep],condition:function(e){return e.stats.idle>3*t.day},effect:function(e){e.timeBonus=-.2}}),n.perks.merchant=e({id:"mrc",name:"merchant",desc:"The ancient art of trading have been one of the most important skill you could have.",action:[n.actions.exchange],iteration:10,effect:function(e){e.consume[0]=1}}),{time:t,ids:n,get:function(e){if(e)return s[e]},bindAll:function(e){s.browse(function(t){t.browse(function(i,n){b.isFunction(i)&&(t[n]=i.bind(e))})})}}}(),y=function(){function e(t,i){if(!i)throw new TypeError("Can't draw asset without destination");this.animationState=0,this.animationSteps=i.steps||1,this.animationSpeed=(i.speed||0)/60,this.source={},this.destination={},this.defineSource(t),this.destination.x=g.floor(+i.x*e.ENLARGE),this.destination.y=g.floor(+i.y*e.ENLARGE)}var t,i,n,s,o;return e.ENLARGE=4,e.prototype={defineSource:function(t){this.source={x:t.x,y:t.y,width:g.floor(t.width/this.animationSteps),height:t.height},this.destination.width=this.source.width*e.ENLARGE,this.destination.height=this.source.height*e.ENLARGE},render:function(e,t){this.animationState=(this.animationState+this.animationSpeed)%this.animationSteps;var i=g.floor(this.animationState)*this.source.width,n=this.destination.x,s=this.destination.y;t.drawImage(e,this.source.x+i,this.source.y,this.source.width,this.source.height,n,s,this.destination.width,this.destination.height)},getDepth:function(){return this.destination.y},compare:function(e){return e.destination.y+e.destination.height-(this.destination.y+this.destination.height)},setPosition:function(e,t){this.destination.x=+e,this.destination.y=+t}},{start:function(r,a,c){t=a,i=c.assets,n=c.positions;var l=f.prepareCanvas(800,300);(s=l.ctx).imageSmoothingEnabled=0,l.cnv.classList.add("layer","buildings"),r.appendChild(l.cnv),o=new Map,E.observe(E.MSG_TYPES.BUILD,function(t){var s=w.get(t);if(s&&s.asset&&i[s.asset]){var r=new e(i[s.asset],n[s.asset]);if(s.upgrade){var a=s.upgrade;o.has(a)&&o.set(a,r)}else o.push(s.id,r)}}.bind(this)),this.render()},render:function(){requestAnimationFrame(this.render.bind(this)),o.size&&(s.clear(),o.getValues().sort(function(e,t){return e.compare(t)}).forEach(function(e){e.render(t,s)}))}}}(),k=function(){var e={0:"info",1:"warning",2:"quote",3:"event"},t=null,i={LOG_TYPES:{INFO:0,WARN:1,QUOTE:2,EVENT:3},maxLog:50,start:function(e){t=e,E.observe(i.LOG_TYPES.values(),function(e,t){i.log(e,t)}).observe(E.MSG_TYPES.ARRIVAL,function(e){i.log(e.name+" has arrived.",E.MSG_TYPES.LOGS.EVENT)}).observe(E.MSG_TYPES.LOOSE_SOMEONE,function(e){var t="We lost "+e.name+".";i.log(t,i.LOG_TYPES.WARN)}).observe(E.MSG_TYPES.LOOSE,function(e){v("Death","survival duration",e);var t="We held up for "+b.formatTime(e)+", but all is lost now.";i.log(t,i.LOG_TYPES.EVENT)}).observe(E.MSG_TYPES.RUNS_OUT,function(e){var t="We run out of "+new u(e).toString(!0)+", we need to do something.";i.log(t,i.LOG_TYPES.WARN)}).observe(E.MSG_TYPES.GAIN_PERK,function(e){var t=e.name+' is now known as the "'+b.capitalize(e.perk.data.name)+'".';i.log(t,i.LOG_TYPES.EVENT)}).observe(E.MSG_TYPES.WIN,function(e){var t="It took "+b.formatTime(e)+" to escape.";i.log(t,i.LOG_TYPES.EVENT)})},log:function(i,n){if(i.length){n=n||0,t.insertBefore(b.wrap("log "+e[n],i),t.firstChild);var s=Array.prototype.slice.call(t.children);s.length>k.maxLog&&s.last().remove()}},personify:function(e,t){return e.replace(/@([\w.]+)\b/gi,function(e,i){var n=t;return i.split(".").forEach(function(e){n=n[e]}),n||""})}};return i}(),E=function(){var e=[],t={observe:function(t,i){return b.isArray(t)||(t=[t]),t.forEach(function(t){e[t]||(e[t]=[]),e[t].push(i)}),this},notify:function(t,i,n){var s=this.SWAP_MSG_TYPE[t];return n||b.log("Message ",s||t,i),e[t]&&e[t].forEach(function(e){e(i,t)}),this},MSG_TYPES:{LOGS:k.LOG_TYPES,CLICK:10,REFRESH:20,GIVE:30,FIND_LOCATION:31,ARRIVAL:33,USE:35,RUNS_OUT:36,LOOSE_RESOURCE:38,LOOSE_SOMEONE:39,UNLOCK:40,GAIN_PERK:45,LOCK:50,START_BUILD:59,BUILD:60,UNBUILD:61,INCIDENT_START:70,INCIDENT_END:72,SAVE:80,LOOSE:90,WIN:95,KEYS:{TAB:1009,SPACE:1032,ENTER:1013,ESCAPE:1027,UP:1038,RIGHT:1039,DOWN:1040,LEFT:1037,CTRL:1017,SHIFT:1016,BACK:1008,ONE:1049,TWO:1050,THREE:1051,FOUR:1052,FIVE:1053,SIX:1054,SEVEN:1055,EIGHT:1056,NINE:1057,ZERO:1048,F5:1116,F8:1119,F12:1123}}},i=[t.MSG_TYPES.KEYS.F5,t.MSG_TYPES.KEYS.F12,t.MSG_TYPES.KEYS.TAB,t.MSG_TYPES.KEYS.ENTER,t.MSG_TYPES.KEYS.SPACE];return window.addEventListener("keydown",function(e){var n=1e3+e.keyCode;i.includes(n)||(e.preventDefault(),e.stopPropagation()),t.notify(n,"down",!0)},!0),window.addEventListener("keyup",function(e){e.preventDefault(),e.stopPropagation();var i=1e3+e.keyCode;i===t.MSG_TYPES.KEYS.ENTER&&e.target.dispatchEvent(new Event("click")),t.notify(i,"up")},!0),t.SWAP_MSG_TYPE=t.MSG_TYPES.swap(),t}(),S=function(){function e(e){return btoa(s+btoa(e))}function t(e){return atob(atob(e).substr(s.length))}var i=localStorage,n=i.getItem("k");n||(n=b.randomStr(),i.setItem("k",n));var s=b.randomStr();return{persist:function(t){i.setItem(n,e(JSON.stringify(t)))},hasData:function(){return Object.keys(i).includes(n)},load:function(){return JSON.parse(t(i.getItem(n)))},clear:function(){i.removeItem(n)}}}(),L=function(){function e(e,t){this.startTime=b.getNow(),this.action=e,this.time=t,this.isRunning=!0,this.timeout=this.setTimeout()}function t(e){var t=i.get(e);if(!t)throw new RangeError("Unknown timer ID ["+e+"]");return t}e.prototype={setTimeout:function(){return setTimeout(this.action,this.time)},getElapsed:function(){return b.getNow()-this.startTime},getRemaining:function(){return this.time-this.getElapsed()},stop:function(){return!!this.isRunning&&(this.isRunning=!1,this.time=this.getRemaining(),clearTimeout(this.timeout),this.time)},restart:function(e){return!this.isRunning&&(this.isRunning=!0,this.startTime=e,this.timeout=this.setTimeout(),this.time)}};var i=new Map;return{timeout:function(t,n){var s;return s=i.push(new e(function(){t(),i.delete(s)},n))},stop:function(e){return t(e).stop()},stopAll:function(){i.forEach(function(e){e.stop()})},restart:function(e){return t(e).restart(b.getNow())},restartAll:function(){var e=b.getNow();i.forEach(function(t){t.restart(e)})},clear:function(e){var n=t(e);i.delete(e),n.stop()},clearAll:function(){i.forEach(function(e){e.clear()})},getElapsed:function(e){return t(e).getElapsed()},getRemaining:function(e){return t(e).getRemaining()}}}();n.RUNNING_CLASS="running",n.extends(i,"Action",{toHTML:function(){var e=this._toHTML();return this.clickable=new d("name disabled animated",b.capitalize(this.data.name)),e.appendChild(this.clickable.html),b.isFunction(this.data.options)?(this.clickable.isDropdown(!0),this.optionsWrapper=b.wrap("options"),this.optionsWrapper.hide(),e.appendChild(this.optionsWrapper),e.addEventListener("mouseover",this.showOptions.bind(this)),e.addEventListener("focusin",this.showOptions.bind(this)),e.addEventListener("mouseout",this.hideOption.bind(this)),e.addEventListener("focusout",this.hideOption.bind(this))):this.clickable.setAction(this.click.bind(this,null)),this.data.order&&(e.style.order=this.data.order),e},showOptions:function(){this.optionsWrapper.show();var e=this.html.getBoundingClientRect();this.optionsWrapper.style.top=e.top+e.height+"px",this.optionsWrapper.style.left=e.left+"px"},hideOption:function(){this.optionsWrapper.hide(),this.optionsWrapper.style.left=""},init:function(){this.data.time=this.data.time||0,b.isUndefined(this.data.energy)&&(this.data.energy=5*this.data.time),this.tooltip=new p(this.clickable.html,this.data),this.manageOptions()},manageOptions:function(){if(b.isFunction(this.data.options)){this.options||(this.options=new Map);var e=this.data.options(this);this.options.forEach(function(t){e.includes(t.data.id)||t.lock()});for(var t,i,s=0,o=e.length;s<o;++s)i=e[s],this.options.has(i)||(t=new n(i,this.owner,this),this.options.push(t),this.optionsWrapper.appendChild(t.html))}},refresh:function(e,t){this.locked=this.owner.isTired()&&this.data.energy>0||this.data.isOut&&t.incidents.includes(w.ids.incidents.easy.sandstorm)||this.parentAction&&this.parentAction.locked,this.tooltip.refresh(e,this.data),b.isArray(this.data.consume)&&!this.locked&&this.data.consume.forEach(function(t){var i=t[1];e.has(i)&&e.get(i).has(t[0])||(this.locked=!0)},this),this.manageOptions(),this.options&&this.options.forEach(function(i){i.refresh(e,t)}),this.clickable.toggle(!this.locked)},click:function(e){if(this.owner.busy||this.locked)return!1;if(this.parentAction)return this.parentAction.click(this.data.id);if(e||!this.options){this.chosenOptionId=e;var t=this.mergeWithOption(e);b.isArray(t.consume)&&E.notify(E.MSG_TYPES.USE,t.consume),t.build&&E.notify(E.MSG_TYPES.START_BUILD,t.build),++this.repeated;var i=this.defineDuration(t);return this.energyDrain=t.energy/i,this.start(i*o.tickLength),v("Action","start",this.data.id),E.notify(E.MSG_TYPES.SAVE),!0}},defineDuration:function(e){var t=e.time||0;return e.timeDelta&&(t+=g.random(-e.timeDelta,e.timeDelta)),e.timeBonus&&(t-=t*e.timeBonus),t},start:function(e,t){var i=e+(t=t||0);this.owner.setBusy(this.data.id,this.energyDrain),this.clickable.startCoolDown(i,t,this.end.bind(this)),this.html.classList.add(n.RUNNING_CLASS)},mergeWithOption:function(e){var t={},i=this.data,n={};e&&(n=w.get(e));var s={},o=n.build||i.build;o&&(o===w.ids.option?o=e:s=w.get(o)),t.build=o,t.optionId=e;var r=["consume","give","giveList","unlock","lock","unlockForAll","lockForAll"],a=[];return["name","desc","log","time","timeDelta","timeBonus","energy","giveSpan"].forEach(function(e){t[e]=s[e]||n[e]||i[e]}),r.forEach(function(e){(i[e]||n[e]||s[e])&&(t[e]=(i[e]||[]).concat(n[e]||[]).concat(s[e]||[]))}),a.forEach(function(e){(s[e]||i[e]||n[e])&&(t[e]=Object.assign({},i[e]||{},n[e]||{},s[e]||{}))}),t},end:function(){this.html.classList.remove(n.RUNNING_CLASS);var e={name:this.data.name,people:this.owner},t=this.mergeWithOption(this.chosenOptionId);this.chosenOptionId=null,this.owner.finishAction(),b.isFunction(this.data.effect)&&this.data.effect(this,t,e);var i=this.resolveAction(e,t);i.give.length&&E.notify(E.MSG_TYPES.GIVE,i.give),i.unlock.forAll.length&&E.notify(E.MSG_TYPES.UNLOCK,i.unlock.forAll),i.unlock.forOne.length&&this.owner.addAction(i.unlock.forOne),i.lock.forAll.length&&E.notify(E.MSG_TYPES.LOCK,i.lock.forAll),i.lock.forOne.length&&this.owner.lockAction(i.lock.forOne),i.build&&E.notify(E.MSG_TYPES.BUILD,i.build),E.notify(e.logType||E.MSG_TYPES.LOGS.INFO,b.capitalize(i.log)),E.notify(E.MSG_TYPES.SAVE)},resolveAction:function(e,t){var i={give:[],unlock:{forAll:[],forOne:[]},lock:{forAll:[],forOne:[]},log:""};b.isArray(t.give)?i.give=t.give:t.giveSpan&&t.giveList&&(i.give=b.randomizeMultiple(t.giveList,t.giveSpan)),i.give.forEach(function(e,i,n){e[1]===w.ids.option&&(n[i]=[e[0],t.optionId])});var n=this.repeated;if(b.isArray(this.data.unlockAfter)&&this.data.unlockAfter.forEach(function(e){n>e[0]&&(i.unlock.forOne.push(e[1]),i.lock.forOne.push(this.data.id))}),b.isArray(t.unlock)){var s=t.unlock.filter(function(e){var t=w.get(e);return!t.condition||t.condition(this)},this);this.data.unique?i.unlock.forAll.insert(s):i.unlock.forOne.insert(s)}if(b.isArray(t.unlockForAll)&&i.unlock.forAll.insert(t.unlockForAll.filter(function(e){var t=w.get(e);return!t.condition||t.condition(this)},this)),b.isArray(this.data.lockAfter)&&this.data.lockAfter.forEach(function(e){n>e[0]&&i.lock.forOne.push(e[1])}),b.isArray(t.lock)&&(this.data.unique?i.lock.forAll=t.lock:i.lock.forOne=t.lock),b.isArray(t.lockForAll)&&i.lock.forAll.insert(t.lockForAll),this.data.unique&&i.lock.forAll.push(this.data.id),t.build){var o=w.get(t.build);i.build=t.build,e.build=b.an(o.name)}i.give=b.compactResources(i.give),e.give=b.formatArray(i.give);var r=t.log||"",a=b.isFunction(r)?r(e,this):r;return i.log=k.personify(a,e),i},lock:function(){this.cancel(),this.tooltip.remove(),this.options?this.options.forEach(function(e){e.lock()}):this.parentAction&&this.parentAction.options.delete(this.data.id),this.html.remove()},cancel:function(){this.clickable.isRunning()&&(this.owner.setBusy(),this.html.classList.remove(n.RUNNING_CLASS),this.clickable.endCoolDown())},toJSON:function(){var e=this._toJSON();return e.repeated=this.repeated,this.clickable.isRunning()&&(e.elapsed=this.clickable.getElapsed(),e.remaining=this.clickable.getRemaining(),e.energyDrain=this.energyDrain,e.optionId=this.chosenOptionId),e}}),s.extends(i,"Building",{toHTML:b.noop,init:function(){this.data.lock&&E.notify(E.MSG_TYPES.LOCK,this.data.lock),this.data.unlock&&E.notify(E.MSG_TYPES.UNLOCK,this.data.unlock),b.isFunction(this.data.effect)&&this.data.effect(this,this.data)}}),o.tickLength=2e3,o.holder=null,o.extends(t,"GameController",{toHTML:function(){var e=this._toHTML(),t=b.wrap("topPart");e.appendChild(t),this.resourcesList=b.wrap(u.LST_ID),e.appendChild(this.resourcesList),this.peopleList=b.wrap(c.LST_ID),t.appendChild(this.peopleList),this.logsList=b.wrap("logs"),t.appendChild(this.logsList),this.visualPane=b.wrap("visualPane"),e.appendChild(this.visualPane),this.incidentsList=b.wrap(r.LST_ID),e.appendChild(this.incidentsList);var i=this,n=b.wrap("bottomOptions"),s=new d("wipe","Clear save",function(){new m({name:"Clear your save",desc:"Completely wipe your saved game. Careful, this is irreversible.",yes:{name:"Restart anew",action:function(){i.wipeSave(),location.reload()}},no:{name:"Cancel"}},"wipeIt")});n.appendChild(s.html);var o=new d("credits","Credits",function(){var e="<ul>";[{task:"Design and code",name:"Guillaume Martigny",url:"https://www.guillaume-martigny.fr"},{task:"Graphics",name:"if you want your name here, send me an email",url:"mailto:https://www.guillaume-martigny.fr"}].forEach(function(t){e+="<li>"+t.task+": <a href='"+t.url+"'>"+t.name+"</a></li>"}),new m({name:"Settlement v0.4.3",desc:e+="</ul>"})});return n.appendChild(o.html),e.appendChild(n),e},init:function(e){w.bindAll(this),e.innerHTML="",e.appendChild(this.html),y.start(this.visualPane,this.assets.images,this.assets.data),k.start(this.logsList),this.registerObservers(),S.hasData()?this.loadGame():(E.notify(E.MSG_TYPES.BUILD,w.ids.buildings.special.wreckage),this.initialActions.push(w.ids.actions.wakeUp),L.timeout(this.prepareNewcomer.bind(this,1),500)),new m({name:"Early access [v0.4.3]",desc:"You'll see a very early stage of the game. It may be broken, it may not be balanced ...<br/>If you want to report a bug or anything to improve the game, go to <a href='https://github.com/GMartigny/settlement'>the project's page</a>.<br/><br/>Thanks for playing !",yes:{name:"Got it !"}}),this.refresh()},registerObservers:function(){var e=this,t=E.MSG_TYPES;E.observe(t.GIVE,function(t){b.isArray(t)&&t.forEach(function(t){e.earn.apply(e,t)})}).observe(t.USE,function(t){b.isArray(t)&&b.compactResources(t).forEach(function(t){e.consume.apply(e,t)})}).observe(t.START_BUILD,function(t){e.buildingsInProgress.push(t)}).observe(t.BUILD,function(t){e.build(t),v("Building","built",t)}).observe(t.ARRIVAL,function(){v("People","arrive",e.getSettledTime())}).observe(t.LOOSE_SOMEONE,function(i){e.people.out(i),v("People","die",i.stats.age),e.people.length<=0&&E.notify(t.LOOSE,e.getSettledTime())}).observe(t.LOOSE,function(){e.flags.gameOver=!0,e.wipeSave()}).observe(t.INCIDENT_START,function(t){e.incidentsList.appendChild(t.html),e.incidents.push(t)}).observe(t.INCIDENT_END,function(t){t.data.unique||e.incidents.delete(t.data.id)}).observe(t.LOCK,this.removeFromInitialActions.bind(this)).observe(t.UNLOCK,this.addToInitialActions.bind(this)).observe(t.SAVE,this.saveGame.bind(this)).observe(t.WIN,function(){this.flags.win=!0,v("Game","win",e.getSettledTime()),new m({name:"You win !!",desc:""})}).observe(t.KEYS.SPACE,function(t){"up"===t&&e.togglePause()})},addToInitialActions:function(e){b.isArray(e)||(e=[e]),e.forEach(function(e){this.initialActions.includes(e)||this.initialActions.push(e)},this),this.people.forEach(function(t){t.addAction(e)})},removeFromInitialActions:function(e){b.isArray(e)||(e=[e]),e.forEach(function(e){this.initialActions.out(e)},this),this.people.forEach(function(t){t.lockAction(e)})},getSettledTime:function(){return this.flags.settled?this.flags.settled/o.tickLength:0},getSurvivalDuration:function(){return b.formatTime(this.getSettledTime())},togglePause:function(){this.flags.paused=!this.flags.paused,this.html.classList.toggle("paused",this.flags.paused),this.html.classList.toggle("backdrop",this.flags.paused),this.flags.paused?L.stopAll():(L.restartAll(),this.lastTick=b.getNow())},refresh:function(){var e=g.floor((b.getNow()-this.lastTick)/o.tickLength);if(this.lastTick+=e*o.tickLength,(this.flags.paused||this.flags.gameOver)&&(e=0),L.timeout(this.refresh.bind(this),o.tickLength/10),e>0){if(this.flags.incidents=this.incidents.getKeys(),this.flags.settled){this.flags.settled+=e*o.tickLength,w.get(w.ids.people).needs.forEach(function(t){this.flags[t[2]]=0;var i=this.incidents.get(w.ids.incidents.hard.drought);t[1]===w.ids.resources.gatherables.common.water&&i&&(t[0]*=i.data.multiplier);var n=t[0]*this.people.length*e;this.consume(n,t[1],function(e){this.flags[t[2]]=e})},this);var t=w.get(w.ids.people).dropRate;this.canSomeoneArrive()&&g.random()<t&&this.prepareNewcomer(),!this.flags.popup&&g.random()<r.DROP_RATE&&this.startIncident(this.getRandomIncident())}this.resources.forEach(function(e,t,i){e.refresh(i)}),this.people.forEach(function(t){t.refresh(this.resources,e,this.flags)},this),E.notify(E.MSG_TYPES.SAVE)}},hasEnough:function(e,t){return this.resources.has(e)&&this.resources.get(e).has(t)},consume:function(e,t,i){if(e){var n=this.resources.get(t);if(n)if(n.has(e))n.update(-e),n.warnLack=!1;else{if(b.isFunction(i)){var s=e-n.count;i.call(this,s,t)}n.set(0),n.warnLack||(n.warnLack=!0,E.notify(E.MSG_TYPES.RUNS_OUT,t))}}},earn:function(e,t){if(this.resources.has(t))this.resources.get(t).update(e);else{var i=new u(t,e);this.resources.push(i),this.resourcesList.appendChild(i.html)}},prepareNewcomer:function(e){var t=this;a(e||1).then(function(e){e.forEach(function(e){e.addAction(t.initialActions),t.people.length||(e.life=0,e.energy=0,e.updateLife(0),e.updateEnergy(0))}),t.arrive(e)})},arrive:function(e){b.isArray(e)||(e=[e]),e.forEach(function(e){this.people.length&&(E.notify(E.MSG_TYPES.ARRIVAL,e),1===this.people.length&&L.timeout(function(){var t=e.name+" say that there's other desert-walkers ready to join you if there's room for them.";E.notify(E.MSG_TYPES.LOGS.QUOTE,t)},2e3)),this.people.push(e),this.peopleList.appendChild(e.html),e.html.offsetHeight,e.show()},this)},build:function(e){if(this.buildingsInProgress.out(e),!this.buildings.has(e)){var t=new s(e);this.buildings.push(t)}},unlockedCraftables:function(){var e=[];return w.ids.resources.craftables.deepBrowse(function(t){var i=w.get(t);i.ifHas&&!this.buildings.has(i.ifHas)||!(!i.condition||b.isFunction(i.condition)&&i.condition())||e.push(t)},this),e},possibleCraftables:function(){var e=this;return this.unlockedCraftables().filter(function(t){var i=w.get(t),n=!0;return b.isFunction(i.consume)&&i.consume(i).forEach(function(t){n=n&&e.hasEnough(t[1],t[0])}),n})},possibleBuildings:function(){var e=[];return w.ids.buildings.deepBrowse(function(t){var i=w.get(t);this.isBuildingInProgress(t)||this.isBuildingDone(t)||i.upgrade&&!this.buildings.has(i.upgrade)||i.ifHas&&!this.isBuildingDone(i.ifHas)||e.push(t)},this),e},isBuildingInProgress:function(e){return this.buildingsInProgress.includes(e)},isBuildingDone:function(e){var t=!1;return this.buildings.forEach(function(i){var n=i.data;if(!(t=t||n.id===e))for(;n.upgrade&&!t;)n=w.get(n.upgrade),t=t||n.id===e},this),t},canSomeoneArrive:function(){return this.hasEnough(w.ids.resources.room,this.people.length+1)},getRandomIncident:function(){var e=[],t=this.getSettledTime()/w.time.week;return t>1&&(e.push.apply(e,w.ids.incidents.easy),t>2&&(e.push.apply(e,w.ids.incidents.medium),t>5&&e.push.apply(e,w.ids.incidents.hard))),(e=e.filter(function(e){var t=w.get(e);return!this.flags.incidents.includes(e)&&(!t.condition||b.isFunction(t.condition)&&t.condition())},this)).length?b.randomize(e):null},startIncident:function(e){if(e){var t=new r(e);t.start(),v("Incident","start",t.data.id)}},saveGame:function(){this.flags.gameOver||S.persist(this)},toJSON:function(){return{stl:this.flags.settled,res:this.resources.getValues(),plp:this.people,iac:this.initialActions,bld:this.buildings.getValues(),inc:this.incidents.getValues(),lct:this.knownLocations,bip:this.buildingsInProgress}},loadGame:function(){var e=S.load();E.notify(E.MSG_TYPES.GIVE,e.res);var t=this;e.plp.forEach(function(e){var i=new c(e.nam,e.gnd);i.setLife(e.lif),i.setEnergy(e.ene),i.stats=e.sts,e.prk&&i.gainPerk(e.prk),e.act.forEach(function(e){i.addAction(e.id);var t=i.actions.get(e.id);t.repeated=e.repeated,e.remaining&&(t.choosenOptionId=e.optionId,t.energyDrain=e.energyDrain,t.start(e.remaining,e.elapsed))}),t.people.push(i),t.peopleList.appendChild(i.html),i.show()}),this.addToInitialActions(e.iac),e.bld.forEach(function(e){E.notify(E.MSG_TYPES.BUILD,e.id)}),e.inc.forEach(function(e){new r(e.id).run(e.remains)}),this.knownLocations=e.lct,this.buildingsInProgress=e.bip,this.flags.settled=e.stl},wipeSave:function(){v("Save","wipe"),S.clear()}}),r.DROP_RATE=.01,r.extends(i,"Incident",{init:function(){this.tooltip&&this.tooltip.remove(),this.tooltip=new p(this.html,this.data);var e=this.data.yes;this.data.yes={name:e,action:this.run.bind(this)};var t=this.data.no;this.data.no=t?{name:t}:null},toHTML:function(){var e=this._toHTML();return this.nameNode=b.wrap("name",b.capitalize(this.data.name)),e.appendChild(this.nameNode),this.progressBar=new h("timer animated"),e.appendChild(this.progressBar.html),e},run:function(e){var t={incident:this.data};if(this.data.time){E.notify(E.MSG_TYPES.INCIDENT_START,this);var i=0;e?i=e:(i=this.data.time*o.tickLength,this.data.deltaTime&&(i+=g.random(-this.data.deltaTime,this.data.deltaTime))),this.progressBar.run(i),this.timer=L.timeout(this.end.bind(this),i)}var n;n=b.isFunction(this.data.log)?this.data.log(t,this):this.data.log||"";var s=k.personify(n,t);E.notify(t.logType||E.MSG_TYPES.LOGS.EVENT,b.capitalize(s))},start:function(){return new m(this.data,"incident"),!!this.data.time},cancel:function(){this.timer&&(L.stop(this.timer),this.end())},end:function(){this.timer=null,E.notify(E.MSG_TYPES.INCIDENT_END,this),this.html.remove(),this.tooltip.remove()},toJSON:function(){var e=this._toJSON();return e.remains=L.getRemaining(this.timer),e}}),r.LST_ID="incidentList",c.LST_ID="peopleList",c.extends(t,"People",{init:function(){this.setPronouns(),new p(this.lifeBar.html,{name:"Health",desc:"The first thing you want is a good health."}),new p(this.energyBar.html,{name:"Energy",desc:"Drained faster when busy or hungry."})},toHTML:function(){var e=this._toHTML();return this.nameNode=b.wrap("name",b.capitalize(this.name)),e.appendChild(this.nameNode),this.lifeBar=new h("life",25),e.appendChild(this.lifeBar.html),this.energyBar=new h("energy"),e.appendChild(this.energyBar.html),this.actionList=b.wrap("actionList"),e.appendChild(this.actionList),e.hide(),e},refresh:function(e,t,i){if(this.actions.forEach(function(t){t.refresh(e,i)}),i.settled){this.stats.age+=t,this.stats.idle+=t;var n=this.perk&&this.perk.id===w.ids.perks.lounger?0:this.energyDrain;this.updateEnergy(-t*(n+30*i.starving));var s=0;i.thirsty&&(s+=30*i.thirsty),i.incidents.includes(w.ids.incidents.medium.acidRain)&&this.busy&&w.get(this.busy).isOut&&(s+=w.get(w.ids.incidents.medium.acidRain).lifeLose),this.updateLife(-t*s)}},setPronouns:function(){switch(this.gender){case"female":this.nominative="she",this.accusative="her",this.possessive="her",this.reflexive="herself";break;case"male":this.nominative="he",this.accusative="him",this.possessive="his",this.reflexive="himself";break;default:this.nominative="it",this.accusative="it",this.possessive="its",this.reflexive="itself"}},setBusy:function(e,t){this.busy=e||!1,e?(e!==w.ids.actions.sleep&&(this.stats.idle=0),this.energyDrain=t):this.energyDrain=1,this.html.classList.toggle("busy",this.busy)},finishAction:function(){this.rollForPerk(this.busy),this.setBusy()},updateEnergy:function(e){var t=this.energy+=e;return t>100?t=100:t<0&&(this.updateLife(t),t=0),this.setEnergy(t),this.energy},setEnergy:function(e){this.energy=e,this.energyBar.set(e)},isTired:function(){return this.energy.equals(0)||this.energy<0},updateLife:function(e){var t=this.life+e;return t>100&&(t=100),this.setLife(t),t},setLife:function(e){this.life=e,this.lifeBar.set(e),e<0&&this.die()},addAction:function(e){b.isArray(e)||(e=[e]),e.forEach(function(e){if(!this.actions.has(e)){var t=new n(e,this);this.actions.push(t),this.actionList.appendChild(t.html)}},this)},lockAction:function(e){b.isArray(e)||(e=[e]),e.forEach(function(e){var t=this.actions.get(e);t&&(t.lock(),this.actions.delete(e))},this)},rollForPerk:function(e){var t=!1;if(!this.perk){var i=this;w.ids.perks.deepBrowse(function(n){if(!l.isUsed(n)){var s=w.get(n),o=s.actions;if((!o||o.includes(e))&&(!b.isFunction(s.condition)||s.condition(i))){var r=0;(r=(r=o?o.reduce(function(e,t){var n=i.actions.get(t);return e+(n?n.repeated:0)},0)/(s.iteration||0):1/(s.iteration||0))<1?0:r)&&g.random()<r&&(i.gainPerk(n),E.notify(E.MSG_TYPES.GAIN_PERK,i),t=!0)}}})}return t},gainPerk:function(e){var t=new l(e,this);this.perk=t,this.nameNode.appendChild(t.html)},hasPerk:function(e){return this.perk&&this.perk.data.id===e},die:function(){this.html.classList.contains("arrived")&&(E.notify(E.MSG_TYPES.LOOSE_SOMEONE,this),this.html.classList.remove("arrived"),this.actions.forEach(function(e){e.cancel(),e.tooltip.remove()}),L.timeout(function(){this.html.remove()}.bind(this),400))},toJSON:function(){return{nam:this.name,gnd:this.gender,lif:this.life,ene:this.energy,sts:this.stats,prk:this.perk&&this.perk.data.id,act:this.actions.getValues()}}}),c.randomName=function(e){return new Promise(function(t,i){var n="https://randomuser.me/api?inc=gender,name&nat="+["AU","BR","CA","CH","DE","DK","ES","FI","FR","GB","IE","NL","NZ","TR","US"].join(",")+"&noinfo&results="+(e||1);fetch(n).then(function(e){if(e.ok)return e.json().then(t);i(new URIError("["+e.status+"] "+n+" "+e.statusText))})})},l.usedId=[],l.isUsed=function(e){return l.usedId.includes(e)},l.extends(i,"Perk",{init:function(){this.data.desc=k.personify(this.data.desc,{people:this.owner}),new p(this.html,this.data),b.isArray(this.data.unlock)&&this.owner.addAction(this.data.unlock),b.isArray(this.data.lock)&&this.owner.lockAction(this.data.lock)},toHTML:function(){var e=this._toHTML();return e.textContent='the "'+b.capitalize(this.data.name)+'"',e}}),u.extends(i,"Resource",{init:function(e){e&&this.update(+e),this.tooltip=new p(this.html,this.data)},toHTML:function(){var e=this._toHTML();this.counter=b.wrap("counter","1"),e.appendChild(this.counter);var t=b.wrap("icon icon-"+this.data.icon);return e.appendChild(t),e.style.order=this.data.order,e},refresh:function(e){this.counter.textContent=this.get(),b.isArray(this.data.consume)&&e&&this.tooltip.refresh(e,this.data)},update:function(e){var t=this.count;if(this.set(this.count+e),g.floor(t)!==g.floor(this.count)){var i=this.html,n=!1;if(e>0&&!i.classList.contains("more")?(i.classList.add("more"),n=!0):e<0&&!i.classList.contains("less")&&(i.classList.add("less"),n=!0),n){L.timeout(i.classList.remove.bind(i.classList,"more","less"),700)}}},get:function(){return g.floor(this.count)},set:function(e){if(this.count=e,this.count<0)throw new RangeError("Resources count can't be negative");return this.refresh()},has:function(e){return this.count>e||this.count.equals(e)},toJSON:function(){return[this.count,this.data.id]},toString:function(e){var t="";return e||(t+=this.count+" "),this.data.icon&&(t+=u.iconAsString(this.data.icon)+" "),t+=b.pluralize(this.data.name,this.count)}}),u.iconAsString=function(e){return b.wrap("icon icon-small-"+e).outerHTML},u.LST_ID="resourceList",h.extends(t,"Bar",{toHTML:function(){var e=this._toHTML();return this.valueBar=b.wrap("value"),e.appendChild(this.valueBar),e},set:function(e){e.equals(this.value)||(this.value=e,this.valueBar.style.width=e+"%",this.html.classList[e<this.threshold?"add":"remove"]("warning"))},run:function(e){e=+e||0,this.valueBar.style.animationDuration=e+"ms",this.html.classList.add("ongoing")}}),d.extends(t,"Clickable",{toHTML:function(){var e=this._toHTML();return e.textContent=this.text,e.tabIndex=0,e},startCoolDown:function(e,t,i){var n=this;this.html.style.animationDuration=e+"ms",this.html.style.animationDelay=-t+"ms",this.html.classList.add("cooldown"),this.timeout=L.timeout(function(){n.endCoolDown(),i()},e-t)},setAction:function(e){b.isFunction(e)&&this.html.addEventListener("click",e,!0)},isRunning:function(){return!!this.timeout},endCoolDown:function(){this.isRunning()&&(L.clear(this.timeout),this.timeout=null,this.html.style.animationDuration="",this.html.style.animationDelay="",this.html.classList.remove("cooldown"))},toggle:function(e){this.html.classList.toggle("disabled",!e),this.html.tabIndex=e?0:-1},setText:function(e){this.text=e,this.html.textContent=e},getElapsed:function(){return L.getElapsed(this.timeout)},getRemaining:function(){return L.getRemaining(this.timeout)},isDropdown:function(e){this.html.classList.toggle("dropdown",e)}}),m.holder=document.body,m.extends(t,"Popup",{toHTML:function(){var e=this._toHTML();e.appendChild(b.wrap("title",b.capitalize(this.data.name))),e.appendChild(b.wrap("description",this.data.desc));var t=this,i=this.data.yes&&this.data.yes.action||b.noop,n=new d("yes",this.data.yes&&this.data.yes.name||"Ok",function(){i(),t.remove()});if(e.appendChild(n.html),this.data.no){var s=this.data.no.action||b.noop,o=new d("no",this.data.no.name||"Cancel",function(){s(),t.remove()});e.appendChild(o.html)}return e},show:function(){m.holder.classList.add("backdrop"),m.holder.appendChild(this.html),this.html.style.top=g.floor((m.holder.offsetHeight-this.html.offsetHeight)/2)+"px",this.html.style.transform="scale3d(1, 1, 1)",this.html.style.opacity="1"},remove:function(){this.html.remove(),m.holder.classList.remove("backdrop")}}),p.extends(t,"Tooltip",{_holderWidth:null,_holderHeight:null,init:function(e){if(this.refresh(new Map,e),!this._holderWidth||!this._holderHeight){var t=(p._holder=o.holder).getBoundingClientRect();this._holderWidth=t.width,this._holderHeight=t.height}this._mouseOver();var i=this.html.getBoundingClientRect();this.width=i.width,this.height=i.height,this._mouseOut(),this._addEvents()},_setPosition:function(e,t){var i=g.constrain(e+10,0,this._holderWidth-this.width),n=g.constrain(t+10,0,this._holderHeight-this.height);this.html.style.left=i+"px",this.html.style.top=n+"px"},_mouseOver:function(){p._holder.appendChild(this.html)},_mouseOut:function(){this.remove()},_mouseMove:function(e){this._setPosition(e.clientX,e.clientY)},_addEvents:function(){this.container.classList.add("tooltiped"),this.container.addEventListener("mouseover",this._mouseOver.bind(this)),this.container.addEventListener("mousemove",this._mouseMove.bind(this)),this.container.addEventListener("mouseout",this._mouseOut.bind(this))},_removeEvents:function(){this.container.classList.remove("tooltiped"),this.container.removeEventListener("mouseover",this._mouseOver),this.container.removeEventListener("mousemove",this._mouseMove),this.container.removeEventListener("mouseout",this._mouseOut)},toHTML:function(){var e=this._toHTML(),t=b.wrap("title");e.appendChild(t),this.nodes.name=t;var i=b.wrap("description");e.appendChild(i),this.nodes.desc=i;var n=b.wrap("time");e.appendChild(n),this.nodes.time=n;var s=b.wrap("consumption");return e.appendChild(s),this.nodes.resourcesContainer=s,e},refresh:function(e,t){this.nodes.name.textContent=b.capitalize(t.name),t.desc?this.nodes.desc.textContent=t.desc:this.nodes.desc.remove(),t.time?this.nodes.time.textContent=b.formatTime(t.time):this.nodes.time.remove(),b.isArray(t.consume)?t.consume.forEach(function(t){var i=t[1],n=this.resourcesMapper[i];if(!n){var s=w.get(i),o=b.wrap("resource not-enough"),r=b.wrap("counter");o.appendChild(r),o.appendChild(b.wrap("",t[0]+" "+s.name)),o.style.order=s.order,n={node:o,counter:r},this.resourcesMapper[i]=n,this.nodes.resourcesContainer.appendChild(o)}var a=(e.has(i)||0)&&e.get(i).get(),c=a<t[0];n.counter.textContent=c?a+"/":"",n.node.classList.toggle("not-enough",c)},this):this.nodes.resourcesContainer.remove()},remove:function(){this.html.remove()}})}("undefined"==typeof window?window={}:window);
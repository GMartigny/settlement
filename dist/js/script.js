!function(){"use strict";function a(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,{cnv:c,ctx:c.getContext("2d")}}function b(){this.items={},this.length=0}function c(a){return a<<0}function d(a){return c(a+.5)}function f(a,b,c){return a<b?b:a>c?c:a}function g(a){this.data=a,this.html=this.toHTML(),this._init.apply(this,Array.prototype.splice.call(arguments,1))}function h(a,b,d){b=b||J;var e=document.body;d="popup"+(d?" "+d:"");var f=j(d);f.appendChild(j("title",o(a.name))),f.appendChild(j("description",a.desc));var g={remove:function(){f.remove(),e.classList.remove("backdrop")}},h=j("yes clickable",a.yes||"Ok");if(h.addEventListener("click",function(){b(),g.remove()}),f.appendChild(h),a.no){var i=j("no clickable",a.no);i.addEventListener("click",g.remove),f.appendChild(i)}return e.appendChild(f),e.classList.add("backdrop"),f.style.top=c((e.offsetHeight-f.offsetHeight)/2)+"px",g}function i(a,b){this.container=a,this.nodes={},this.resourcesMapper={},this.box=this.toHTML(b),this._mouseOver(),this.width=this.box.offsetWidth,this.height=this.box.offsetHeight,this._mouseOut(),this._addEvents()}function j(a,b){var c=document.createElement("div");return a&&c.classList.add.apply(c.classList,a.split(" ")),b&&(c.innerHTML=b),c}function k(a){var b=["year","month","day","hour","minute"],d=[],e=L.time;return b.forEach(function(b){if(a>=e[b]){var f=c(a/e[b]);a%=e[b],d.push(f+" "+n(b,f))}}),m(d)}function l(a){var b=[];return a.forEach(function(a){var c=n(a[1].name,a[0]);a[1].icon&&(c+=" "+H.iconAsString(a[1].icon)),b.push(a[0]+" "+c)}),m(b)}function m(a,b){return a.length>1?(a[a.length-2]+=" "+(b||"and")+" "+a.pop(),a.join(", ")):a.length?a[0]:""}function n(a,b){return a+(b>1&&"s"!==a[a.length-1]?"s":"")}function o(a){return a?(a=a.replace(/([\.!\?]) ([a-z])/g,function(a,b,c){return b+" "+c.toUpperCase()}),a[0].toUpperCase()+a.slice(1)):""}function p(a,b){if(!a.values().length)throw new TypeError("Can't pick from empty list");var c={},e=[],f=0;a.deepBrowse(function(a){a.dropRate&&(f+=a.dropRate,e.push(f),c[f]=a)});var g=d(I(f));e.sort();for(var h=0,i=e.length;h<i;++h)if(e[h]>g){g=e[h];break}return b?(t(b)||(b=u(b)?b.split("-"):[+b]),[d(I.apply(null,b)),c[g]]):c[g]}function q(a,b){if(!b)throw new TypeError("Need an amount");var c=[];t(b)||(b=u(b)?b.split("-"):[+b]);for(var e=d(I.apply(null,b)),f=0;f<e;){var g=d(I(1,e-f));c.push([g,p(a)]),f+=g}return c}function r(a,b,c){c=c||Object.keys(b);var d=b.clone();return c.forEach(function(b){d[b]&&s(d[b])&&(d[b]=d[b](a))}),d}function s(a){return a instanceof Function}function t(a){return Array.isArray(a)}function u(a){return"string"==typeof a}function v(a){return void 0===a}function w(a){return a.toLowerCase().replace(/(\W)+/g,"_")}function x(a){return("aeiou".split("").includes(a[0])?"an":"a")+" "+a}function y(a){return a.reduce(function(a,b){var c=a.find(function(a){return a[1].id===b[1].id});return c?c[0]+=b[0]:b[0]>0&&a.push(b),a},[])}function z(a,b){var c={},d=0,e=a.length;return Promise.all(a.map(function(a){var f,g=fetch(a).then(function(b){if(b.ok)return b;throw URIError("["+b.status+"] "+a+" "+b.statusText)});switch(a.substr(a.lastIndexOf(".")+1)){case"png":case"jpg":case"gif":f=g.then(function(a){var b=new Image;return a.blob().then(function(a){return b.src=URL.createObjectURL(a),b})});break;case"json":f=g.then(function(a){return a.json()});break;default:f=Promise.resolve()}return f.then(function(f){c[w(a)]=f,b(++d/e*100,a)})})).then(function(){return c})}function A(a,b){if(!b)throw new TypeError("Can't draw asset without destination");this.animationState=0,this.animationSteps=b.animationSteps||1,this.source={},this.destination={},this.defineSource(a),this.destination.x=c(+b.x*A.ENLARGE),this.destination.y=c(+b.y*A.ENLARGE)}function B(a,b,c){this.locked=!0,this.running=!1,this.nameNode=null,this.options=null,this.optionsWrapper=null,this.owner=a,this.parentAction=c||null,this.repeated=0,this.super(b)}function C(a){this.super(a)}function D(a){this.timer=null,this.nameNode=null,this.progressBar=null,this.tooltip=null,this.super(a)}function E(a,c){var e=d(performance.now());console.log("Loaded in "+e+"ms"),console.log("Starting v0.2.3"),this.assets=c,this.resources=new b,this.buildings=new b,this.events=new b,this.people=[],this.initialActions=new b,this.knownLocations=new b,this.flags={ready:!1,paused:!1,settled:!1,survived:0,popup:!1,productivity:1},this.super(),a.appendChild(this.html),console.log("Started in "+d(performance.now()-e)+"ms")}function F(a){return G.randomName(a).then(function(a){var b=[];return a.results.forEach(function(a){var c=o(a.name.first+""),d=new G(c,a.gender);b.push(d)}),b})}function G(a,c){this.name=a,this.gender=c||"other",this.actions=new b,this.busy=!1,this.energy=100,this.starving=!1,this.life=100,this.thirsty=!1,this.stats={actionsDone:{},idle:0,age:0},this.perk=null,this.super()}function H(a,b){this.count=0,this.warnLack=!1,this.super(a,b)}CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)},b.prototype={push:function(a,b){return v(b)&&(b=a,a=b.id||this.length+1),!this.has(a)&&(this.items[a]=b,++this.length)},pop:function(a){var b=this.items[a];return!!b&&(delete this.items[a],--this.length,b)},has:function(a){return!!this.items[a]},get:function(a){if(!this.has(a))throw new RangeError("Unknown ID ("+a+") in Collection ("+this+")");return this.items[a]},set:function(a,b){var c=this.get(a);return this.items[a]=b,c},forEach:function(a){this.length>0&&this.items.browse(function(b,c){a(b,c,this)}.bind(this))},filter:function(a){var c=new b;return this.forEach(function(b,d,e){a(b,d,e)&&c.push(d,b)}),c},values:function(){return this.items.values()},keys:function(){return Object.keys(this.items)},random:function(){return this.values().random()},clear:function(){this.items={},this.length=0},toString:function(){return"["+this.keys().join(", ")+"]"}};var I=function(){var a=Math.random;return function(b,c){return v(c)?(c=v(b)?1:+b||1,b=0):(b=+b||0,c=+c||1),a()*(c-b)+b}}();g.prototype={_init:function(){},toHTML:function(){return j(this.modelName)}},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.random=function(){return this[c(I(0,this.length))]},Array.prototype.out=function(a){return this.splice(this.indexOf(a),1),this.length},Object.prototype.values=function(){var a=[];return this.browse(function(b){a.push(b)}),a},Object.prototype.browse=function(a){var b=this;Object.keys(this).forEach(function(c){a(b[c],c,b)})},Object.prototype.deepBrowse=function(a){this.browse(function(b,c,d){b.name?a(b,c,d):b.deepBrowse(a)})},Object.prototype.swap=function(){var a={};return this.browse(function(b,c){a[b]=c}),a},Object.prototype.clone=function(){var a;if(void 0===this||null===this||[Boolean,Number,String].includes(this.constructor))a=this;else if(this instanceof Array)a=this.slice();else{if(!(this instanceof Object))throw new TypeError("Improbable source type");a=Object.assign({},this)}return a},Function.prototype.extends=function(a,b,c){if(a&&(this.prototype=Object.create(a.prototype),this.prototype.super=a,this.prototype.constructor=this,this.prototype.modelName=b),c){var d=this;c.browse(function(a,b){d.prototype[b]&&(d.prototype["_"+b]=d.prototype[b]),d.prototype[b]=a})}},i.prototype={bodyWidth:document.body.offsetWidth,bodyHeight:document.body.offsetHeight,_setPosition:function(a,b){var c=f(a+10,0,this.bodyWidth-this.width),d=f(b+10,0,this.bodyHeight-this.height);this.box.style.left=c+"px",this.box.style.top=d+"px"},_mouseOver:function(){document.body.appendChild(this.box)},_mouseOut:function(){this.box.remove()},_mouseMove:function(a){this._setPosition(a.clientX,a.clientY)},_addEvents:function(){this.container.classList.add("tooltiped"),this.container.addEventListener("mouseover",this._mouseOver.bind(this)),this.container.addEventListener("mousemove",this._mouseMove.bind(this)),this.container.addEventListener("mouseout",this._mouseOut.bind(this))},_removeEvents:function(){this.container.classList.remove("tooltiped"),this.container.removeEventListener("mouseover",this._mouseOver),this.container.removeEventListener("mousemove",this._mouseMove),this.container.removeEventListener("mouseout",this._mouseOut)},toHTML:function(a){var b=j("tooltip"),c=j("title",o(a.name));if(b.appendChild(c),this.nodes.name=c,a.desc){var d=j("description",a.desc);b.appendChild(d),this.nodes.desc=d}if(a.time){var e=j("time",k(a.time));b.appendChild(e),this.nodes.time=e}if(t(a.consume)){var f=j("consumption");a.consume.forEach(function(a){var b=j("resource not-enough",a[0]+" "+a[1].name);this.resourcesMapper[a[1].id]=b,f.appendChild(b)}.bind(this)),b.appendChild(f)}return b},refresh:function(a,b){this.nodes.name=b.name,b.desc&&(this.nodes.desc.textContent=b.desc),b.time&&(this.nodes.time.textContent=k(b.time)),t(b.consume)&&b.consume.forEach(function(b){var c=b[1].id,d=a.has(c)&&a.get(c).has(b[0]);this.resourcesMapper[c].classList.toggle("not-enough",!d)}.bind(this))},remove:function(){this.box.remove()}};var J=new Function,K=function(){var a=[];return function(){var b="------".replace(/-/g,function(){return d(I(36)).toString(36)});return a.includes(b)?K():(a.push(b),b)}}();!function(){console.groupCollapsed("Loading");z(["dist/img/icons.png","dist/img/assets.png","dist/js/assets.json"],function(a,b){console.log(b+" : "+a.toFixed(1)+"% - "+d(performance.now()))}).then(function(a){console.groupEnd();try{new E(document.body,{images:a[w("dist/img/assets.png")],data:a[w("dist/js/assets.json")]})}catch(a){console.warn("Fail to load game : "+a.message,a.stack)}}).catch(function(a){console.warn(a.message,e.stack)})}();var L=function(){var a={minute:1/60,hour:1,day:24,week:168,month:720,year:8640},b=["north","south","east","west","north-east","north-west","south-east","south-west"],c={resources:{gatherables:{common:{water:{name:"water",desc:"Water is definitely important to survive in this harsh environment.",icon:"water-bottle",dropRate:100,order:10},food:{name:"food",desc:"Everyone need food to keep his strength.",icon:"foodcan",dropRate:100,order:20},rock:{name:"rock",desc:'"There\'s rocks everywhere ! Why would you bring this back ?"',icon:"rock",dropRate:100,order:30},scrap:{name:"scrap metal",desc:"An old rusty piece of metal.",icon:"metal-scraps",dropRate:90,order:40}},uncommon:{bolts:{name:"nuts and bolts",desc:"Little metal nuts and bolts to fasten anything in place.",icon:"nuts-and-bolts",dropRate:70,order:50},sand:{name:"sand",desc:"Just pure fine sand.",icon:"sand-pile",dropRate:40,order:55},oil:{name:"fuel",desc:"About a liter of gas-oil.",icon:"jerrycan",dropRate:10,order:60}},rare:{medication:{name:"medication",desc:"An unlabeled medication, hope it's still good.",icon:"medications",dropRate:7,order:70},electronic:{name:"electronics",desc:"Some basic micro-electronics components.",icon:"electronic-parts",dropRate:10,order:75}},special:{ruins:{name:"location",desc:"Directions to a point of interest we found earlier.",icon:"map",order:80,dropRate:.6},quartz:{name:"quartz cristal",desc:"A rough uncut gem of quartz. Quite valuable.",icon:"gem",dropRate:.1,order:77}}},craftables:{basic:{stone:{name:"smooth stone",desc:"A round and well polish stone.",icon:"stone",consume:function(){return[[3,c.resources.gatherables.common.rock]]},dropRate:100,order:90},glass:{name:"glass pane",desc:"A see-through building component.",icon:"glass-pane",condition:function(){return this.buildings.has(c.buildings.small.furnace.id)},consume:function(){return[[4,c.resources.gatherables.uncommon.sand]]},dropRate:60,order:100},component:{name:"component",desc:"Some mechanical parts for others craftables.",icon:"pipes-large",consume:function(){return[[2,c.resources.gatherables.common.scrap],[2,c.resources.gatherables.uncommon.bolts]]},dropRate:120,order:110},tool:{name:"tool",desc:"The base for any tinkerer.",icon:"tools",consume:function(){return[[1,c.resources.craftables.basic.component],[2,c.resources.gatherables.common.rock]]},dropRate:90,order:111}},complex:{brick:{name:"brick",desc:"Bricks will give walls for larger constructions.",icon:"brick",condition:function(){return this.buildings.has(c.buildings.small.well.id)},consume:function(){return[[1,c.resources.craftables.basic.stone],[1,c.resources.craftables.basic.tool]]},dropRate:80,order:112},circuit:{name:"circuit",desc:"That's a little rough, but it's actually a functioning circuit board.",icon:"electronic-circuit-board",consume:function(){return[[1,c.resources.gatherables.common.scrap],[2,c.resources.craftables.basic.component],[3,c.resources.gatherables.rare.electronic]]},dropRate:60,order:114},metalPipe:{name:"metal pipe",desc:"Pipes that you forge from junk metal.",icon:"pipes-small",condition:function(){return this.buildings.has(c.buildings.medium.forge.id)},consume:function(){return[[4,c.resources.gatherables.common.scrap],[1,c.resources.craftables.basic.tool]]},dropRate:80,order:115},furniture:{name:"furniture",desc:"A proper settlement needs better than pile of trash for table and seats.",icon:"glass-table",consume:function(){return[[2,c.resources.craftables.basic.glass],[2,c.resources.craftables.complex.metalPipe]]},dropRate:40,order:116}},advanced:{jewelry:{name:"jewelry",desc:"A really beautiful ornament you could use for trading.",icon:"jewelry",condition:function(){return this.buildings.has(c.buildings.small.furnace.id)},consume:function(){return[[4,c.resources.gatherables.rare.electronic],[3,c.resources.gatherables.special.quartz]]},dropRate:40,order:117},engine:{name:"engine",desc:"Amazing what you manage to do with all those scraps !",icon:"engine",condition:function(){return this.buildings.has(c.buildings.big.workshop.id)},consume:function(){return[[10,c.resources.gatherables.uncommon.oil],[5,c.resources.craftables.basic.tool],[5,c.resources.craftables.complex.metalPipe]]},dropRate:30,order:120},computer:{name:"computer",desc:"Well, Internet is down since 2136 but it can still be useful.",icon:"computer",condition:function(){return this.buildings.has(c.buildings.big.workshop.id)},consume:function(){return[[10,c.resources.craftables.basic.component],[7,c.resources.craftables.basic.tool],[3,c.resources.craftables.complex.circuit]]},dropRate:20,order:130}}},room:{name:"room",desc:"A place for someone in the camp.",icon:"person",order:0}},people:{name:"people",desc:"The workforce and the bane of you camp.",consumption:{water:1/a.day,food:1/a.day},needs:function(a){return[[c.people.consumption.water*(a.drought?2:1),c.resources.gatherables.common.water,"thirsty"],[c.people.consumption.food,c.resources.gatherables.common.food,"starving"]]},dropRate:.1},buildings:{small:{forum1:{name:"forum+1",desc:"Add a sleeping place in our forum.",time:2,condition:function(){var a=this.buildings;return!(a.has(c.buildings.medium.forum2)||a.has(c.buildings.medium.forum3))},consume:function(){return[[6,c.resources.gatherables.uncommon.bolts],[4,c.resources.gatherables.common.scrap]]},give:function(){return[[1,c.resources.room]]},asset:"forum+1",log:"One more room"},furnace:{name:"furnace",desc:"Survival require to craft as much as to gather things.",time:7,condition:function(){return!this.buildings.has(c.buildings.medium.forge)},consume:function(){return[[8,c.resources.gatherables.common.rock],[2,c.resources.gatherables.uncommon.oil]]},asset:"furnace",log:"A simple furnace that can smelt small things like sand or little electronics."},plot:{name:"farm plot",desc:"A little arranged plot of soil to grow some food.",time:9,condition:function(){return!this.buildings.has(c.buildings.medium.plot1)},consume:function(){return[[5,c.resources.gatherables.common.food],[10,c.resources.gatherables.uncommon.sand]]},unlock:function(){return[c.actions.harvest]},asset:"plot",log:"More crops required more care but that's going to help us keeping a constant stock of food."},pharmacy:{name:"pharmacy",desc:'"Maybe we should avoid letting medications rot in plain sunlight ?!"',time:6,consume:function(){return[[5,c.resources.gatherables.rare.medication],[4,c.resources.craftables.basic.component]]},asset:"pharmacy",log:"Sorting our medications should prevent further mistakes and bad reaction."},well:{name:"well",desc:"Just a large hole into the ground.",time:16,condition:function(){return!this.buildings.has(c.buildings.big.pump.id)},consume:function(){return[[10,c.resources.craftables.basic.stone],[3,c.resources.craftables.basic.tool]]},give:function(){return[[5,c.resources.gatherables.common.water]]},unlock:function(){return[c.actions.drawFrom.well]},lock:function(){return[c.actions.drawFrom.river.id]},asset:"well",log:"Drawing water from the ground should allow to further polish stone into bricks."}},medium:{forum2:{name:"forum+2",desc:"More people mean more workforce right ?",time:5,condition:function(){return!this.buildings.has(c.buildings.big.forum3)},consume:function(){return[[10,c.resources.gatherables.uncommon.sand],[2,c.resources.craftables.basic.stone],[3,c.resources.craftables.basic.glass]]},upgrade:function(){return c.buildings.small.forum1.id},give:function(){return[[1,c.resources.room]]},asset:"forum+2",log:"Add one room"},plot1:{name:"field",desc:"",time:10,consume:function(){return[[20,c.resources.gatherables.common.food],[5,c.resources.gatherables.uncommon.sand],[3,c.resources.gatherables.rare.medication]]},upgrade:function(){return c.buildings.small.plot.id},asset:"plot+1",log:""},forge:{name:"forge",desc:"A good upgrade to the furnace.",time:10,consume:function(){return[[6,c.resources.gatherables.uncommon.oil],[10,c.resources.craftables.basic.stone],[2,c.resources.craftables.basic.tool]]},upgrade:function(){return c.buildings.small.furnace.id},asset:"furnace+1",log:"We can now work metal better and make more complex part."}},big:{forum3:{name:"forum+3",desc:"",time:6,consume:function(){return[[10,c.resources.craftables.complex.brick],[2,c.resources.craftables.complex.furniture],[6,c.resources.craftables.basic.glass]]},upgrade:function(){return c.buildings.medium.forum2.id},give:function(){return[[2,c.resources.room]]},asset:"forum+3",log:"Add two rooms"},workshop:{name:"workshop",desc:"Organizing your workforce make them more efficient at crafting.",time:3*a.day,energy:90,condition:function(){return this.buildings.has(c.buildings.small.furnace.id)},consume:function(){return[[6,c.resources.gatherables.common.scrap],[5,c.resources.craftables.basic.glass],[10,c.resources.craftables.basic.tool],[15,c.resources.craftables.complex.brick]]},give:function(){return[]},asset:"workshop",log:"Good organisation allow you to prepare project and do much more complex crafting."},radio:{name:"radio-station",desc:"Broadcasting could finally bring us some help.",time:6,condition:function(){return this.buildings.has(c.buildings.big.workshop.id)},consume:function(){return[[4,c.resources.craftables.complex.circuit],[1,c.resources.craftables.advanced.computer]]},asset:"radio",log:'"Message received. We thought no one survive the crash. Glad you still have the cube.Unfortunately we can\'t risk being located, bring it to sent position. Over."'},pump:{name:"water pump",desc:"A buried contraption that collect water from the earth moisture.",time:3*a.day,energy:120,consume:function(){return[[20,c.resources.craftables.basic.stone],[5,c.resources.craftables.complex.metalPipe],[1,c.resources.craftables.advanced.engine]]},upgrade:function(){return c.buildings.small.well.id},unlock:function(){return[c.actions.drawFrom.well]},asset:"pump",log:"A big upgrade to your well ! Now we have a continuous flow of water coming."},trading:{name:"trading post",desc:"Since the radio station bring a handful of merchant, better take advantage of it.",time:a.day,energy:70,condition:function(){return this.buildings.has(c.buildings.big.radio.id)&&this.resources.has(c.resources.craftables.complex.jewelry)},consume:function(){return[[2,c.resources.craftables.basic.glass],[10,c.resources.craftables.complex.brick],[2,c.resources.craftables.complex.furniture]]},unlock:function(){return[c.actions.exchange]},asset:"trading",log:"Arranging some space allow us to trade with merchant caravan passing by."},module:{name:"module",desc:"With that, we can finally deliver the cube to security.",time:a.week,energy:100,condition:function(){return this.buildings.has(c.buildings.big.radio.id)},consume:function(){return[[15,c.resources.gatherables.uncommon.oil],[3,c.resources.craftables.complex.furniture],[1,c.resources.craftables.advanced.computer],[2,c.resources.craftables.advanced.engine]]},unlock:function(){return[c.actions.launch]},asset:"module",log:"What a journey, but there we are. We build so many things and explore lots of places.<br/>Now it's time to end it all !"}},special:{wreckage:{name:"wreckage",desc:"Remainings of space-ships.",asset:"wreckage",log:""},forum:{name:"forum",desc:"The center and start of our settlement.",unlock:function(){return[c.actions.sleep]},upgrade:function(){return c.buildings.special.wreckage.id},give:function(){return[[1,c.resources.room]]},asset:"forum",log:""}}},actions:{wakeUp:{name:"wake up",unlock:function(a){return a.owner.updateEnergy(100),a.owner.updateLife(100),[c.actions.look]},log:"@people.name gets up painfully.",order:0,unique:!0},look:{name:"look around",desc:"What am I doing here ?",time:1,energy:0,give:function(){return Q.timeout(function(){P.notify(P.MSG_TYPES.LOGS.FLAVOR,"We need a shelter.")},1500),[[10,c.resources.gatherables.common.water],[8,c.resources.gatherables.common.food],[2,c.resources.craftables.basic.component]]},unlock:function(){return[c.actions.settle]},log:"After some thinking, @people.name remembers the attack. @people.nominative grabs @give laying around.",order:0,unique:!0},settle:{name:"settle here",desc:"Ok, let's settle right there !",time:2,energy:0,unlock:function(){return this.flags.settled=!0,[c.actions.gather]},build:function(){return c.buildings.special.forum},log:"@people.name installs @build inside a ship-wreck with @give to sleep in.",order:0,unique:!0},gather:{name:"gather resources",desc:"Go out to bring back resources, that's the best you can do.",time:3,isOut:1,unlock:function(){return[c.actions.roam,c.actions.craft]},giveSpan:[3,6],give:function(a){return q(c.resources.gatherables,a.data.giveSpan)},log:"@people.name comes back with @give.",order:0},roam:{name:"roam",desc:"Explore the surroundings hoping to find something interesting.",time:6,isOut:1,consume:function(){return[[1,c.resources.gatherables.common.water]]},condition:function(a){return!a.owner.actions.has(c.actions.scour.id)},unlock:function(a){var b=[c.actions.explore];return a.repeated>9&&b.push(c.actions.scour),b},lock:function(a){var b=[];return a.repeated>9&&b.push(a.data.id),b},giveSpan:[1,3],give:function(a,b,d){var e=q(c.resources.gatherables,a.data.giveSpan);if(I()<c.resources.gatherables.special.ruins.dropRate){e.push([1,c.resources.gatherables.special.ruins]);var f=p(c.locations.near);this.knownLocations.push(f),d.location=x(f.name)}return e},log:function(a){var c;return c=a.location?"Heading @direction, @people.name spots @location, so @people.nominative brings back @give.":"Despite nothing special found towards @direction, @people.name brings back @give.",a.direction=b.random(),c},order:10},scour:{name:"scour",desc:"Knowledge of the area allows for better findings.",time:5,isOut:1,consume:function(){return[[2,c.resources.gatherables.common.water]]},giveSpan:[2,4],give:function(a,b,d){var e=p(c.resources.gatherables,a.data.giveSpan),f=c.resources.gatherables.special.ruins.dropRate,g=a.owner.perk&&a.owner.perk.id===c.perks.explorer,h=g?1:.5;if(I()<f+(1-f)*h){e.push([1,c.resources.gatherables.special.ruins]);var i=p(g?c.locations.epic:c.locations.far);this.knownLocations.push(i),d.location=x(i.name)}return e},log:function(a){return a.location?"@people.name knew @people.nominative could find @location towards @direction, so @people.nominative comes back with @give.":"No special location towards @direction, but @people.name find @give."},order:10},explore:{name:"explore",desc:"Remember that location we saw the other day ? Let's see what we can find there.",time:a.day+4*a.hour,energy:100,isOut:1,consume:function(){return[[3,c.resources.gatherables.common.water],[1,c.resources.gatherables.common.food],[1,c.resources.gatherables.special.ruins]]},options:function(){return this.knownLocations.values()},giveSpan:[7,10],give:function(a,b,c){var d=b;return c.location=d,q(d.give(),a.data.giveSpan)},log:function(a){var b=a.location.log||"";return s(b)?b(a,action):b},order:20},craft:{name:"craft something",desc:"Use some resources to tinker something useful.",time:function(){return this.buildings.has(c.buildings.big.workshop.id)?4:5},options:function(){return this.unlockedCraftables()},give:function(a,b){return[[1,b]]},unlock:function(){return[c.actions.build]},log:function(){return"@people.name succeeds to craft @give."},order:30},build:{name:"build",desc:"Put together some materials to come up with what looks like a building.",build:function(a,b){return b},options:function(){return this.possibleBuildings()},order:50},drawFrom:{river:{name:"draw water",desc:"Get some water from the river.",time:8,energy:50,isOut:1,condition:function(a){return!a.owner.actions.has(c.actions.drawFrom.well.id)},giveSpan:[2,6],give:function(a){return[[d(I.apply(null,a.data.giveSpan)),c.resources.gatherables.common.water]]},log:"Coming back from the river, @people.name brings @give with @people.accusative.",order:60},well:{name:"draw water",desc:"Get some water from our well.",time:2,energy:15,giveSpan:[1,3],give:function(a){var b=this.buildings.has(c.buildings.big.pump.id);return[[d(I.apply(null,a.data.giveSpan)+(b?4:0)),c.resources.gatherables.common.water]]},log:"Using our well, @people.name get @give.",order:60}},harvest:{name:"harvest crops",desc:"It's not the biggest vegetables, but it'll fill our stomachs.",time:function(){return this.buildings.has(c.buildings.medium.plot1.id)?6:4},consume:function(){return[[this.buildings.has(c.buildings.medium.plot1.id)?3:2,c.resources.gatherables.common.water]]},giveSpan:[1.5,2],give:function(a){var b=this.buildings.has(c.buildings.medium.plot1.id);return[[d(I.apply(null,a.data.giveSpan)*(b?2:1)),c.resources.gatherables.common.food]]},log:"Our crops produce @give.",order:70},sleep:{name:"sleep",desc:"Get some rest to restore energy.",time:7,energy:0,give:function(a){return a.owner.updateEnergy(100),[]},unlock:function(){return[c.actions.heal]},log:"@people.name feels well rested now.",order:5},heal:{name:"heal",desc:'"I really hope those pills are still good."',time:2,energy:1,consume:function(){return[[2,c.resources.gatherables.rare.medication]]},give:function(a,b){var d=99;return!this.buildings.has(c.buildings.small.pharmacy.id)&&I()<.4&&(d=-10,b.wasBad=!0),a.owner.updateLife(d),[]},log:function(a){return a.wasBad?"After feeling not so well, @people.name realise taking these pillstook a hit on his health.":"This time, it actually improve @people's health."},order:6},exchange:{name:"exchange",desc:"Caravan passing by carry lots of useful stuff, let's see what's possible to trade.",time:7,energy:20,consume:function(){return[[2,c.resources.craftables.complex.jewelry]]},giveSpan:[2,3],give:function(a){return q({basic:c.resources.craftables.basic,complex:c.resources.craftables.complex},a.data.giveSpan)},log:"@people.name manage to trade a couple of jewelries for @give."},launch:{name:"launch",desc:"",time:12,energy:30,isOut:1,consume:function(){return[[10,c.resources.gatherables.uncommon.oil]]},give:function(){return P.notify(P.MSG_TYPES.WIN),[]},log:function(){return"After "+this.getSurvivalDuration()+", you finally leave this damn crash-site.<br/>You have to leave everyone behind. You make a promise to yourself to come back as soon as you can."}}},locations:{near:{mountain:{name:"mountain",desc:"",give:function(){return[c.resources.gatherables.common.rock,c.resources.gatherables.common.scrap,c.resources.craftables.basic.component]},log:"That was hard to climb those mountains, but at least @people find @give.",dropRate:90},desert:{name:"desert",desc:"",give:function(){return[c.resources.gatherables.common.scrap,c.resources.gatherables.uncommon.oil,c.resources.gatherables.uncommon.sand]},log:"Dunes everywhere give a felling of hopelessness. Anyway, here's @give for the stock.",dropRate:100},supermarket:{name:"hangar",desc:"",give:function(){return[c.resources.gatherables.common.food,c.resources.gatherables.rare.medication,c.resources.craftables.basic.glass]},log:"Quite easy to loot, but full of dangers too. Hopefully, @people.name return safely and got @give.",dropRate:80}},far:{river:{name:"river",desc:"",unlock:function(){return[c.actions.drawFrom.river]},give:function(){return[c.resources.gatherables.common.water,c.resources.gatherables.uncommon.bolts,c.resources.craftables.basic.stone]},log:"It's nice by the river, @people.name found @give.",dropRate:40},ruin:{name:"old ruin",desc:"",give:function(){return[c.resources.gatherables.rare.electronic,c.resources.craftables.basic.component,c.resources.craftables.basic.tool]},log:"Amazing no-one get lost in those caves to get @give.",dropRate:60}},epic:{building:{name:"abandoned building",desc:"",give:function(){return[c.resources.gatherables.rare.medication,c.resources.craftables.basic.glass,c.resources.craftables.complex.circuit]},log:"No-one could guess what that building was, but it sure was interesting. @people.name find @give.",dropRate:30},spaceship:{name:"spaceship wreck",desc:"",give:function(){return[c.resources.gatherables.rare.electronic,c.resources.craftables.basic.tool,c.resources.craftables.complex.furniture]},log:"What a chance to find a wreckage with not melted stuff inside. It was possible to get @give.",dropRate:20}}},events:{dropRate:.01,easy:{sandstorm:{name:"sandstorm",desc:"The wind is blowing hard, impossible to go out for now.",time:20,timeDelta:4,effect:function(a){this.flags.cantGoOut=a},dropRate:100,log:"A sandstorm has started and prevent anyone from leaving the camp."}},medium:{},hard:{drought:{name:"drought",desc:"The climate is so hot, we consume more water.",time:3*a.day,timeDelta:10,effect:function(a){this.flags.drought=a},dropRate:6,log:"A harsh drought has fall, water will be more important than ever."}}},perks:{dropRate:.1,first:{name:"first-one",desc:"The very first one to install the settlement.",actions:function(){return[c.actions.settle.id]},iteration:0},rookie:{name:"rookie",desc:"All group has a rookie, all @people.nominative want is to prove @people.nominative's efficient.",condition:function(){return this.people.length>2},effect:function(a){a.time=.95*(s(a.time)?a.time():a.time)}},explorer:{name:"gadabout",desc:"The veteran of the camp and leader of the exploration. @people.nominative knows the best spot of resources.",actions:function(){return[c.actions.roam.id,c.actions.scour.id,c.actions.explore.id]},iteration:30,effect:function(a){if(a.id===c.actions.explore.id){a.data.giveSpan=a.data.giveSpan.map(function(a){return a+2})}}},tinkerer:{name:"tinkerer",desc:"",actions:function(){return[c.actions.craft.id,c.actions.build.id]},iteration:30,effect:function(a){a.time=.6*(s(a.time)?a.time():a.time)}},healer:{name:"doctor",desc:"Knowing enough about medicine make @people.accusative confident to heal others.",actions:function(){return[c.actions.heal.id]},condition:function(){return this.buildings.has(c.buildings.small.pharmacy.id)},iteration:5,effect:function(a){var b=this.people;a.give=function(){var a=null;return b.forEach(function(b){(!a||b.life<a.life)&&(a=b)}),a.updateLife(99),[]}}},harvester:{name:"harvester",desc:"",actions:function(){return[c.actions.gather.id,c.actions.harvest.id,c.actions.drawFrom.river.id,c.actions.drawFrom.well.id]},iteration:40,effect:function(a){a.data.giveSpan=a.data.giveSpan.map(function(a){return 1.5*a})}},lounger:{name:"lounger",desc:"Doing nothing all day's not gonna make things done.",actions:function(){return[c.actions.sleep]},condition:function(b){return b.stats.idle/(3*a.day)},effect:function(a){
a.time=1.2*(s(a.time)?a.time():a.time)}},merchant:{name:"merchant",desc:"The ancient art of trading have been one of the most important skill you could have.",action:function(){return[c.actions.exchange]},iteration:10,effect:function(a){a.consume=function(){return[[1,c.resources.craftables.complex.jewelry]]}}}}};return{time:a,data:c}}(),M=function(){var c,d,e,f,g,h,i={"forum+1":{x:80,y:30},"forum+2":{x:80,y:30},"forum+3":{x:80,y:30},forum:{x:80,y:30},"furnace+1":{x:63,y:6},furnace:{x:63,y:6},module:{x:172,y:28},pharmacy:{x:86,y:35},"plot+1":{x:23,y:23},plot:{x:31,y:28},pump:{x:101,y:58},radio:{x:63,y:57},trading:{x:28,y:53},well:{x:112,y:59},workshop:{x:132,y:10},wreckage:{x:80,y:30}},j=0,k=0;return{start:function(l,m,n){c=m,d=n;var o=a(800,300);e=o.ctx,e.imageSmoothingEnabled=0,o.cnv.classList.add("layer","buildings"),l.appendChild(o.cnv),o=a(l.offsetWidth,l.offsetHeight),g=o.ctx,o.cnv.classList.add("layer","events"),l.appendChild(o.cnv),f=new b,P.observe(P.MSG_TYPES.BUILD,function(a){if(a.asset){var b=new A(d[a.asset],i[a.asset]);if(s(a.upgrade)){var c=a.upgrade(a);f.has(c)&&f.set(c,b)}else f.push(a.id,b)}}.bind(this)),P.observe(P.MSG_TYPES.UNBUILD,function(a){f.pop(a.id)}),h=new b,P.observe(P.MSG_TYPES.EVENT_START,function(a){a.asset&&h.push(a.id,new A(d[a.asset],a.asset))}),P.observe(P.MSG_TYPES.EVENT_END,function(a){h.pop(a.id)}),P.observe([P.MSG_TYPES.USE,P.MSG_TYPES.GIVE],function(a){switch(a.id){case L.data.resources.gatherables.common.water:j=a.get();break;case L.data.resources.gatherables.common.food:k=a.get()}}),this.render()},render:function(){requestAnimationFrame(this.render.bind(this)),f.length&&(e.clear(),f.values().sort(function(a,b){return a.compare(b)}).forEach(function(a){a.render(c,e)})),h.length&&(g.clear(),h.forEach(function(a){a.render(c,g)}))}}}();A.ANIMATION_INC=2/60,A.ENLARGE=4,A.prototype={defineSource:function(a){this.source={x:a.x,y:a.y,width:c(a.width/this.animationSteps),height:a.height},this.destination.width=this.source.width*A.ENLARGE,this.destination.height=this.source.height*A.ENLARGE},render:function(a,b){this.animationState=(this.animationState+A.ANIMATION_INC)%this.animationSteps;var d=c(c(this.animationState)*this.source.width),e=this.destination.x,f=this.destination.y;b.drawImage(a,this.source.x+d,this.source.y,this.source.width,this.source.height,e,f,this.destination.width,this.destination.height)},getDepth:function(){return this.destination.y},compare:function(a){return a.destination.y+a.destination.height-(this.destination.y+this.destination.height)},setPosition:function(a,b){this.destination.x=+a,this.destination.y=+b}};var N=function(){var a={};return window.addEventListener("keyup",function(b){b.keyCode;var c=a[b.keyCode];s(c)&&c()}),{KEYS:{SPACE:32,ENTER:13,ESCAPE:27,UP:38,RIGHT:39,DOWN:40,LEFT:37,CTRL:17,SHIFT:16,BACK:8,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,ZERO:48},attach:function(b,c){a[b]=c},detach:function(b){a[b]=null}}}(),O=function(){var a={0:"info",1:"warning",2:"flavor",3:"event"},b=null,c={LOG_TYPES:{INFO:0,WARN:1,FLAVOR:2,EVENT:3},maxLog:50,start:function(a){b=a,P.observe(c.LOG_TYPES.values(),function(a,b){c.log(a,b)}).observe(P.MSG_TYPES.ARRIVAL,function(a){c.log(a+" has arrived.",P.MSG_TYPES.LOGS.EVENT)}).observe(P.MSG_TYPES.LOOSE_SOMEONE,function(a){var b="We lost "+a.name+".";c.log(b,c.LOG_TYPES.WARN)}).observe(P.MSG_TYPES.LOOSE,function(a){var b="We held up for "+a+", but all is lost now.";c.log(b,c.LOG_TYPES.FLAVOR)}).observe(P.MSG_TYPES.RUNS_OUT,function(a){var b=a.icon?H.iconAsString(a.icon):"",d="We run out of "+a.name+" "+b+", we need to do something.";c.log(d,c.LOG_TYPES.WARN)}).observe(P.MSG_TYPES.GAIN_PERK,function(a){var b=a.name+' is now known as the "'+o(a.perk.name)+'".';c.log(b,c.LOG_TYPES.EVENT)})},log:function(c,d){if(c.length){d=d||0,b.insertBefore(j("log "+a[d],c),b.firstChild);var e=Array.prototype.slice.call(b.children);e.length>O.maxLog&&e.last().remove()}},personify:function(a,b){return a.replace(/@([\w\.]+)\b/gi,function(a,c){var d=b;return c.split(".").forEach(function(a){d=d[a]}),d||""})}};return c}(),P=function(){var a=[],b={observe:function(b,c){return t(b)||(b=[b]),b.forEach(function(b){a[b]||(a[b]=[]),a[b].push(c)}),this},notify:function(b,c,d){this.SWAP_MSG_TYPE[b];return a[b]&&a[b].forEach(function(a){a(c,b)}),this},MSG_TYPES:{LOGS:O.LOG_TYPES,CLICK:10,REFRESH:20,GIVE:30,FIND_LOCATION:31,ARRIVAL:33,USE:35,RUNS_OUT:36,LOOSE_RESOURCE:38,LOOSE_SOMEONE:39,UNLOCK:40,GAIN_PERK:45,LOCK:50,START_BUILD:59,BUILD:60,UNBUILD:61,EVENT_START:70,EVENT_CANCEL:71,EVENT_END:72,LOOSE:80,WIN:85}};return b.SWAP_MSG_TYPE=b.MSG_TYPES.swap(),b}(),Q=function(){function a(a,b){this.startTime=performance.now(),this.action=a,this.time=b,this.isRunning=!0,this.timeout=this.setTimeout()}a.prototype={setTimeout:function(){return setTimeout(this.action,this.time)},getElapsed:function(){return performance.now()-this.startTime},getRemaining:function(){return this.time-this.getElapsed()},stop:function(){return!!this.isRunning&&(this.isRunning=!1,this.time=this.getRemaining(),clearTimeout(this.timeout),this.time)},restart:function(a){return!this.isRunning&&(this.isRunning=!0,this.startTime=a,this.timeout=this.setTimeout(),this.time)}};var c=new b;return{timeout:function(b,d){var e,f=function(){c.pop(e),b()};return e=c.push(new a(f,d))},stop:function(a){return c.get(a).stop()},stopAll:function(){c.forEach(function(a){a.stop()})},restart:function(a){return c.get(a).restart(performance.now())},restartAll:function(){var a=performance.now();c.forEach(function(b){b.restart(a)})},clear:function(a){return c.pop(a).stop()},clearAll:function(){c.forEach(function(a){a.clear()})},getRemaining:function(a){return c.get(a).getRemaining()}}}();B.COOLDOWN_CLASS="cooldown",B.RUNNING_CLASS="running",B.DISABLED_CLASS="disabled",B.extends(g,"Action",{_init:function(){var a=r(this,this.data,["time","energy","consume"]);v(this.data.energy)&&a.time&&(this.data.energy=5*a.time),this.tooltip=new i(this.nameNode,a),this.manageOptions()},toHTML:function(){var a=this._toHTML(),b=j("name clickable disabled animated",o(this.data.name));return this.nameNode=b,a.appendChild(b),s(this.data.options)?(a.classList.add("withOptions"),this.optionsWrapper=j("options"),a.appendChild(this.optionsWrapper)):a.addEventListener("click",this.click.bind(this)),a.style.order=this.data.order,a},manageOptions:function(){if(s(this.data.options)){this.options||(this.options=new b);var a=this.data.options(this);this.options.forEach(function(b){a.find(function(a){return a.id===b.data.id})||b.lock()});for(var c,d,e=0,f=a.length;e<f;++e)d=a[e],this.options.has(d.id)||(c=new B(this.owner,d,this),this.options.push(d.id,c),this.optionsWrapper.appendChild(c.html))}},refresh:function(a,b){var c=r(this,this.data,["time","energy","consume"]);this.locked=this.owner.isTired()&&c.energy>0||this.data.isOut&&b.cantGoOut||this.parentAction&&this.parentAction.locked,this.tooltip.refresh(a,c),t(c.consume)&&(this.locked||c.consume.forEach(function(b){var c=b[1].id;a.has(c)&&a.get(c).has(b[0])||(this.locked=!0)}.bind(this))),this.manageOptions(),this.options&&this.options.forEach(function(c){c.refresh(a,b)}),this.locked?this.nameNode.classList.add(B.DISABLED_CLASS):this.nameNode.classList.remove(B.DISABLED_CLASS)},click:function(a){if(this.running||this.owner.busy||this.locked)return!1;if(this.parentAction)return this.parentAction.click(this.data);var b=Object.assign({},a,this.data),c=r(this,b,["time","timeDelta","consume"]);t(c.consume)&&P.notify(P.MSG_TYPES.USE,c.consume),this.html.classList.add(B.RUNNING_CLASS),++this.repeated,this.owner.setBusy(c);var d=(c.time||0)*E.tickLength;return c.timeDelta&&(d+=I(-c.timeDelta,c.timeDelta)*E.tickLength),this.nameNode.style.animationDuration=d+"ms",this.nameNode.classList.add(B.COOLDOWN_CLASS),this.timeout=Q.timeout(this.end.bind(this,a),d),!0},end:function(a){this.timeout=0,this.html.classList.remove(B.RUNNING_CLASS),this.nameNode.classList.remove(B.COOLDOWN_CLASS);var b={name:this.data.name,people:this.owner};if(s(this.data.build)){var c=this.data.build(this,a,b);b.build=x(c.name)}var d=[];s(this.data.give)&&(d=this.data.give(this,a,b)),c&&s(c.give)&&(d=d.concat(c.give(this,a,b))),d=y(d),d.length&&(P.notify(P.MSG_TYPES.GIVE,d),b.give=l(d));var e=[],f=[];if(s(this.data.unlock)){var g=this.data.unlock(this,a,b).filter(function(a){return!a.condition||a.condition&&a.condition(this)}.bind(this));this.data.unique?f=g:e=g}c&&s(c.unlock)&&(f=f.concat(c.unlock(this,a,b))),f.length&&P.notify(P.MSG_TYPES.UNLOCK,f),e.length&&this.owner.addAction(e);var h=[],i=[];if(s(this.data.lock)){var j=this.data.lock(this,a,b);this.data.unique?i=j:h=j}this.data.unique&&i.push(this.data.id),c&&s(c.lock)&&(i=i.concat(c.lock(this,a,b))),i.length&&P.notify(P.MSG_TYPES.LOCK,i),h.length&&this.owner.lockAction(h),c&&P.notify(P.MSG_TYPES.BUILD,c);var k=a&&a.log||this.data.log,m="";k&&(m=s(k)?k(b,this):k);var n=O.personify(m,b);P.notify(b.logType||P.MSG_TYPES.LOGS.INFO,o(n)),this.owner.finishAction()},applyEffect:function(a){s(a)},lock:function(){this.cancel(),this.tooltip.remove(),this.options?this.options.forEach(function(a){a.lock()}):this.parentAction&&this.parentAction.options.pop(this.data.id),this.html.remove()},cancel:function(){this.timeout&&(Q.clear(this.timeout),this.owner.setBusy(!1),this.html.classList.remove(B.RUNNING_CLASS),this.nameNode.classList.remove(B.COOLDOWN_CLASS))}}),C.extends(g,"Building",{}),D.extends(g,"Event",{_init:function(){var a=r(this,this.data,["time","consume"]);this.tooltip&&this.tooltip.remove(),this.tooltip=new i(this.html,a)},toHTML:function(){var a=this._toHTML();return this.nameNode=j("name",o(this.data.name)),a.appendChild(this.nameNode),this.progressBar=j("animated bar"),a.appendChild(this.progressBar),a},start:function(a){return h(this.data,function(){if(this.data.effect(!0),this.data.time){P.notify(P.MSG_TYPES.EVENT_START,this);var b=this.data.time*E.tickLength;this.data.deltaTime&&(b+=I(-this.data.deltaTime,this.data.deltaTime)),this.progressBar.style.animationDuration=b+"ms",this.html.classList.add("ongoing"),this.timer=Q.timeout(this.end.bind(this),b)}a&&a(this)}.bind(this),"event"),!!this.data.time},end:function(){this.data.effect(!1),this.timer=null,P.notify(P.MSG_TYPES.EVENT_END,this),this.html.remove()}}),D.LST_ID="eventList",E.tickLength=2e3,E.extends(g,"GameController",{toHTML:function(){var a=this._toHTML();return this.resourcesList=j(),this.resourcesList.id=H.LST_ID,a.appendChild(this.resourcesList),this.peopleList=j(),this.peopleList.id=G.LST_ID,a.appendChild(this.peopleList),this.visualPane=j(),this.visualPane.id="visualPane",a.appendChild(this.visualPane),this.eventsList=j(),this.eventsList.id=D.LST_ID,a.appendChild(this.eventsList),this.logsList=j(),this.logsList.id="logs",a.appendChild(this.logsList),a},_init:function(){var a=this;L.data.deepBrowse(function(b){b.id=K(),b.browse(function(c,d){s(c)&&(b[d]=c.bind(a))})}),this.initialActions.push(L.data.actions.wakeUp),N.attach(N.KEYS.SPACE,this.togglePause.bind(this)),M.start(this.visualPane,this.assets.images,this.assets.data),O.start(this.logsList),Q.timeout(this.welcome.bind(this,1,!0),500),P.observe(P.MSG_TYPES.GIVE,function(b){t(b)&&b.forEach(function(b){a.earn.apply(a,b)})}).observe(P.MSG_TYPES.USE,function(b){t(b)&&y(b).forEach(function(b){a.consume.apply(a,b)})}).observe(P.MSG_TYPES.BUILD,function(b){b&&a.build(b)}).notify(P.MSG_TYPES.BUILD,L.data.buildings.special.wreckage).observe(P.MSG_TYPES.LOOSE_SOMEONE,function(b){a.people.out(b),a.people.length<=0&&(P.notify(P.MSG_TYPES.LOOSE,a.getSurvivalDuration()),a.flags.paused=!0)}).observe(P.MSG_TYPES.EVENT_START,function(b){a.events.push(b.data.id,b)}).observe(P.MSG_TYPES.EVENT_END,function(b){a.events.pop(b.data.id)}).observe(P.MSG_TYPES.LOCK,function(b){a.removeFromInitialActions(b)}).observe(P.MSG_TYPES.UNLOCK,function(b){a.addToInitialActions(b)}).observe(P.MSG_TYPES.WIN,function(){this.flags.paused=!0}),h({name:"Early access",desc:"You'll see a very early stage of the game. It may be broken, it may not be balanced ...<br/>If you want to report a bug or anything to improve the game, go to <a href='https://github.com/GMartigny/settlement'>the project's page</a>.<br/><br/>Thanks for playing !"},function(){this.flags.ready=!0}.bind(this)),this.lastTick=performance.now(),this.refresh()},addToInitialActions:function(a){t(a)||(a=[a]),a.forEach(function(a){this.initialActions.push(a)}.bind(this)),this.people.forEach(function(b){b.addAction(a)})},removeFromInitialActions:function(a){t(a)||(a=[a]),a.forEach(function(a){this.initialActions.pop(a)}.bind(this)),this.people.forEach(function(b){b.lockAction(a)})},getSettledTime:function(){return this.flags.settled?this.flags.survived/E.tickLength:0},getSurvivalDuration:function(){return k(this.getSettledTime())},togglePause:function(){this.flags.paused=!this.flags.paused,this.html.classList.toggle("paused",this.flags.paused),this.html.classList.toggle("backdrop",this.flags.paused),this.flags.paused?Q.stopAll():Q.restartAll()},refresh:function(){var a=performance.now(),b=c((a-this.lastTick)/E.tickLength);if(this.lastTick+=b*E.tickLength,this.flags.paused&&(b=0),setTimeout(this.refresh.bind(this),E.tickLength/3),b>0){if(this.flags.settled){this.flags.survived+=b*E.tickLength;var d=L.data.people.needs(this.flags);if(P.notify(P.MSG_TYPES.USE,d,!0),d.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=this.resources.has(c.id)&&this.resources.get(c.id);e||(e=new H(c),this.resources.push(e)),e.count<b?(e.warnLack||(P.notify(P.MSG_TYPES.RUNS_OUT,c),e.warnLack=!0),this.flags[d]+=b-e.count):(e.warnLack=!1,this.flags[d]=0)}.bind(this)),this.canSomeoneArrive()&&I()<L.data.people.dropRate&&this.welcome(),!this.flags.popup&&I()<L.data.events.dropRate){var e=this.getRandomEvent();if(e){var f=new D(e);this.flags.popup=f.start(function(a){a.data.time&&this.eventsList.appendChild(a.html),this.flags.popup=!1}.bind(this))}}}this.resources.forEach(function(a,b,c){a.refresh(c)}),this.people.forEach(function(a){a.refresh(this.resources,b,this.flags)}.bind(this))}},hasEnough:function(a,b){return this.resources.get(a).has(b)},consume:function(a,b,c){if(a){var d=this.resources.get(b.id);if(d&&d.has(a))d.update(-a),d.warnLack=!1;else if(s(c)){var e=a-d.get();d.set(0),c.call(this,e,b),d.warnLack||(d.warnLack=!0,P.notify(P.MSG_TYPES.RUNS_OUT,b.name))}}},earn:function(a,b){var c=b.id;if(this.resources.has(c))this.resources.get(c).update(a);else{var d=new H(b,a);this.resources.push(c,d),this.resourcesList.appendChild(d.html)}},welcome:function(a,b){var c=this;F(a).then(function(a){a.forEach(function(a){a.addAction(c.initialActions.values()),c.people.push(a),c.peopleList.appendChild(a.html),b?(a.life=0,a.energy=0,a.updateLife(0),a.updateEnergy(0)):(a.html.offsetHeight,P.notify(P.MSG_TYPES.ARRIVAL,a.name),2===c.people.length&&Q.timeout(function(){P.notify(P.MSG_TYPES.LOGS.FLAVOR,a.name+" say that there's other desert-walkers ready to join you if there's room for them.")},2e3)),a.html.classList.add("arrived")})})},build:function(a){var b=a.id;if(!this.buildings.has(b)){var c=new C(a);this.buildings.push(b,c),s(a.lock)&&this.removeFromInitialActions(a.lock(c)),s(a.unlock)&&this.addToInitialActions(a.unlock(c))}},upgradeBuilding:function(a){a&&this.buildings.set(a.from,a.to)},unlockedCraftables:function(){var a=[];return L.data.resources.craftables.deepBrowse(function(b){(!b.condition||s(b.condition)&&b.condition())&&a.push(b)}),a},possibleCraftables:function(){var a=this.resources.items;return this.unlockedCraftables().filter(function(b){var c=!0;return s(b.consume)&&b.consume(b).forEach(function(b){c=c&&a[b[1].id]&&a[b[1].id].has(b[0])}),c})},possibleBuildings:function(){var a=[],b=this.buildings;return L.data.buildings.deepBrowse(function(c){b.has(c.id)||s(c.condition)&&!c.condition(c)||s(c.upgrade)&&!b.has(c.upgrade())||a.push(c)}),a},canSomeoneArrive:function(){return this.hasEnough(L.data.resources.room.id,this.people.length+1)},getRandomEvent:function(){var a=[],b=this.getSettledTime()/L.time.week;return b>1&&(a.push.apply(a,L.data.events.easy.values()),b>2&&(a.push.apply(a,L.data.events.medium.values()),b>5&&a.push.apply(a,L.data.events.hard.values()))),a=a.filter(function(a){return!this.events.has(a.id)&&(!a.condition||s(a.condition)&&a.condition(a))}.bind(this)),a.length?p(a):null}}),G.extends(g,"People",{_init:function(){this.setPronouns()},toHTML:function(){var a=this._toHTML(),b=j("name",o(this.name));return this.perkNode=j("perk"),b.appendChild(this.perkNode),a.appendChild(b),this.lifeBar=j("bar life"),new i(this.lifeBar,{name:"Health",desc:"The first thing you want is a good health."}),a.appendChild(this.lifeBar),this.energyBar=j("bar energy"),new i(this.energyBar,{name:"Energy",desc:"Drained faster when busy or hungry."}),a.appendChild(this.energyBar),this.actionList=j("actionList"),a.appendChild(this.actionList),a},refresh:function(a,b,c){if(this.actions.forEach(function(b){b.refresh(a,c)}),c.settled){this.stats.age+=b,this.stats.idle+=b;var d=.7;this.busy?d=(this.busy.energy||0)/this.busy.time:this.perk&&this.perk.id===L.data.perks.lounger.id&&(d=0),this.updateEnergy(-b*d-30*this.starving),this.thirsty&&this.updateLife(-b*this.thirsty*30)}this.starving=0,this.thirsty=0},setPronouns:function(){switch(this.gender){case"female":this.nominative="she",this.accusative="her",this.possessive="her",this.reflexive="herself";break;case"male":this.nominative="he",this.accusative="him",this.possessive="his",this.reflexive="himself";break;default:this.nominative="it",this.accusative="it",this.possessive="it",this.reflexive="itself"}},setBusy:function(a){a&&a.id!==L.data.actions.sleep.id&&(this.stats.idle=0),this.busy=a||!1,this.html.classList.toggle("busy",this.busy)},finishAction:function(){this.stats.actionsDone[this.busy.id]?++this.stats.actionsDone[this.busy.id]:this.stats.actionsDone[this.busy.id]=1,this.rollForPerk(this.busy),this.setBusy(null)},updateEnergy:function(a){return this.energy+=a,this.energy>100?this.energy=100:this.energy<0&&(this.updateLife(this.energy),this.energy=0),this.energyBar.style.width=this.energy+"%",this.energy},isTired:function(){return this.energy<=0},updateLife:function(a){return this.life+=a,this.life>100?this.life=100:this.life<0&&this.die(),this.lifeBar.style.width=this.life+"%",this.lifeBar.classList[this.life<25?"add":"remove"]("warning"),this.life},addAction:function(a){if(t(a))for(var b=0,c=a.length;b<c;++b)this.addAction(a[b]);else if(!this.actions.has(a.id)){var d=new B(this,a);this.perk&&s(this.perk.effect)&&(this.perk.actions&&!this.perk.actions().includes(a.id)||d.applyEffect(this.perk.effect)),this.actions.push(a.id,d),this.actionList.appendChild(d.html)}},lockAction:function(a){if(t(a))for(var b=0,c=a.length;b<c;++b)this.lockAction(a[b]);else this.actions.has(a)&&this.actions.pop(a).lock()},rollForPerk:function(a){var b=!1;if(!this.perk){var c=this,d=L.data.perks;d.deepBrowse(function(e){if(!G.usedPerks.includes(e.id)){var f=s(e.actions)&&e.actions();if((!f||f.includes(a.id))&&(!s(e.condition)||e.condition(a))){var g=0;g=f?f.reduce(function(a,b){return a+(c.stats.actionsDone[b]||0)},0)/(e.iteration||0):1/(e.iteration||0),g=g<1?0:g,g&&I()<d.dropRate*g&&(c.gainPerk.call(c,e),b=!0)}}})}return b},gainPerk:function(a){a.desc=O.personify(a.desc,{people:this}),this.perk=a,this.perkNode.textContent='the "'+o(a.name)+'"',new i(this.perkNode,a),P.notify(P.MSG_TYPES.GAIN_PERK,this),s(a.unlock)&&this.addAction(a.unlock()),s(a.lock)&&this.lockAction(a.lock()),G.usedPerks.push(a.id)},die:function(){this.html.classList.contains("arrived")&&(P.notify(P.MSG_TYPES.LOOSE_SOMEONE,this),this.html.classList.remove("arrived"),this.actions.forEach(function(a){a.cancel(),a.tooltip.remove()}),Q.timeout(function(){this.html.remove()}.bind(this),400))}}),G.LST_ID="peopleList",G.usedPerks=[],G.randomName=function(a){return new Promise(function(b,c){var d=["AU","BR","CA","CH","DE","DK","ES","FI","FR","GB","IE","NL","NZ","TR","US"],e="https://randomuser.me/api?inc=gender,name&nat="+d.join(",")+"&noinfo&results="+(a||1);fetch(e).then(function(a){if(a.ok)return a.json().then(b);c(URIError("["+a.status+"] "+e+" "+a.statusText))})})},H.extends(g,"Resource",{_init:function(a){a&&this.update(+a);var b=r(this,this.data,["consume"]);this.tooltip=new i(this.html,b)},toHTML:function(){var a=this._toHTML();this.counter=j("counter","1"),a.appendChild(this.counter);var b=j("icon icon-"+this.data.icon);return a.appendChild(b),a.style.order=this.data.order,a},refresh:function(a){this.counter.textContent=c(this.count),a&&t(this.data.consume)&&this.tooltip.refresh(a,this.data.consume)},update:function(a){var b=this.count;if(this.set(this.count+a),c(b)!==c(this.count)){var d;a>0&&!this.html.classList.contains("more")?(this.html.classList.add("more"),d=function(){this.html.classList.remove("more")}.bind(this)):a<0&&!this.html.classList.contains("less")&&(this.html.classList.add("less"),d=function(){this.html.classList.remove("less")}.bind(this)),s(d)&&Q.timeout(d,700)}},get:function(){return d(this.count)},set:function(a){if(this.count=a,this.count<0)throw new RangeError("Resources count can't be negative");return this.refresh()},has:function(a){return this.count>=a},toString:function(){var a=this.count+" "+n(this.data.name,this.count);return this.data.icon&&(a+=" "+H.iconAsString(this.data.icon)),a}}),H.iconAsString=function(a){return j("icon icon-small-"+a).outerHTML},H.LST_ID="resourceList"}();